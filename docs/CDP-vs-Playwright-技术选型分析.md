# CDP vs Playwright æŠ€æœ¯é€‰å‹æ·±åº¦åˆ†æ

## æ–‡æ¡£ä¿¡æ¯
- **ç‰ˆæœ¬**ï¼šv1.0
- **åˆ›å»ºæ—¥æœŸ**ï¼š2025-12-18
- **ç›®æ ‡**ï¼šä¸º AeroTest AI é€‰æ‹©æœ€ä¼˜æµè§ˆå™¨é©±åŠ¨æ–¹æ¡ˆ

---

## ç›®å½•
1. [æŠ€æœ¯æ¦‚è¿°](#1-æŠ€æœ¯æ¦‚è¿°)
2. [æ ¸å¿ƒå¯¹æ¯”](#2-æ ¸å¿ƒå¯¹æ¯”)
3. [æ€§èƒ½å¯¹æ¯”](#3-æ€§èƒ½å¯¹æ¯”)
4. [åŠŸèƒ½å®Œæ•´æ€§å¯¹æ¯”](#4-åŠŸèƒ½å®Œæ•´æ€§å¯¹æ¯”)
5. [å¼€å‘ä½“éªŒå¯¹æ¯”](#5-å¼€å‘ä½“éªŒå¯¹æ¯”)
6. [ä¸ AeroTest AI éœ€æ±‚å¥‘åˆåº¦](#6-ä¸-aerotest-ai-éœ€æ±‚å¥‘åˆåº¦)
7. [æˆæœ¬åˆ†æ](#7-æˆæœ¬åˆ†æ)
8. [æœ€ç»ˆå»ºè®®](#8-æœ€ç»ˆå»ºè®®)

---

## 1. æŠ€æœ¯æ¦‚è¿°

### 1.1 CDP (Chrome DevTools Protocol)

```
å®šä¹‰ï¼š
Chrome DevTools Protocol æ˜¯ Chrome æµè§ˆå™¨æä¾›çš„åº•å±‚åè®®ï¼Œ
ç”¨äºè°ƒè¯•ã€æ£€æŸ¥ã€åˆ†æå’Œæ§åˆ¶æµè§ˆå™¨è¡Œä¸ºã€‚

ç‰¹ç‚¹ï¼š
- ğŸ“¡ åŸºäº WebSocket çš„åŒå‘é€šä¿¡åè®®
- ğŸ”§ Chrome å®˜æ–¹ç»´æŠ¤
- ğŸ¯ åº•å±‚ã€çµæ´»ã€åŠŸèƒ½å¼ºå¤§
- âš™ï¸ éœ€è¦æ‰‹åŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ

æŠ€æœ¯æ ˆï¼š
- åè®®å±‚ï¼šCDP Protocol (JSON-RPC over WebSocket)
- Python åº“ï¼š
  - cdp-use (browser-use ä½¿ç”¨)
  - pychrome
  - pyppeteer2 (Puppeteer Python ç§»æ¤)
  - playwright-python (åº•å±‚ä¹Ÿç”¨ CDPï¼Œä½†æœ‰å°è£…)

æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Your Code   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ JSON-RPC Commands
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CDP Protocol â”‚
â”‚ (WebSocket)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chrome      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Playwright

```
å®šä¹‰ï¼š
Playwright æ˜¯ Microsoft å¼€å‘çš„ç°ä»£åŒ–æµè§ˆå™¨è‡ªåŠ¨åŒ–æ¡†æ¶ï¼Œ
æä¾›é«˜çº§ API å’Œè·¨æµè§ˆå™¨æ”¯æŒã€‚

ç‰¹ç‚¹ï¼š
- ğŸ­ é«˜çº§å°è£…ï¼ŒAPI å‹å¥½
- ğŸŒ å¤šæµè§ˆå™¨æ”¯æŒï¼ˆChromiumã€Firefoxã€WebKitï¼‰
- ğŸš€ å†…ç½®ç­‰å¾…ã€é‡è¯•ã€è‡ªåŠ¨åŒ–æœ€ä½³å®è·µ
- ğŸ“¦ å¼€ç®±å³ç”¨

æŠ€æœ¯æ ˆï¼š
- ä¸Šå±‚ï¼šPlaywright API (Python/JavaScript/Java/.NET)
- ä¸­å±‚ï¼šPlaywright Server (Node.js)
- åº•å±‚ï¼šCDP (Chromium) / Firefox Debug Protocol / WebKit Inspector

æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Your Code   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Playwright API
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Playwright   â”‚
â”‚   Server     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ CDP/Firefox Protocol/WebKit Inspector
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Browser     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®ï¼šPlaywright åº•å±‚ä¹Ÿä½¿ç”¨ CDPï¼ˆå¯¹äº Chromiumï¼‰ï¼Œ
     ä½†æä¾›äº†æ›´é«˜çº§çš„å°è£…å’Œè·¨æµè§ˆå™¨æŠ½è±¡ã€‚
```

---

## 2. æ ¸å¿ƒå¯¹æ¯”

### 2.1 æ€»è§ˆå¯¹æ¯”è¡¨

| ç»´åº¦ | CDP (åŸç”Ÿ) | Playwright | è¯´æ˜ |
|------|-----------|-----------|------|
| **æ€§èƒ½** | â­â­â­â­â­ | â­â­â­â­ | CDP æ›´å¿«ï¼ˆæ— ä¸­é—´å±‚ï¼‰ |
| **æ˜“ç”¨æ€§** | â­â­ | â­â­â­â­â­ | Playwright ç®€å•å¾ˆå¤š |
| **åŠŸèƒ½å®Œæ•´æ€§** | â­â­â­â­â­ | â­â­â­â­â­ | éƒ½å¾ˆå®Œæ•´ |
| **è·¨æµè§ˆå™¨** | â­â­ | â­â­â­â­â­ | CDP ä»… Chrome |
| **æ–‡æ¡£è´¨é‡** | â­â­â­ | â­â­â­â­â­ | Playwright æ–‡æ¡£æ›´å¥½ |
| **ç¤¾åŒºæ”¯æŒ** | â­â­â­ | â­â­â­â­â­ | Playwright ç¤¾åŒºæ›´æ´»è·ƒ |
| **å­¦ä¹ æ›²çº¿** | â­â­ | â­â­â­â­ | CDP å­¦ä¹ æˆæœ¬é«˜ |
| **ç»´æŠ¤æˆæœ¬** | â­â­ | â­â­â­â­â­ | CDP éœ€è¦æ‰‹åŠ¨ç®¡ç†å¾ˆå¤šç»†èŠ‚ |
| **ç¨³å®šæ€§** | â­â­â­â­ | â­â­â­â­â­ | Playwright æ›´ç¨³å®š |
| **è°ƒè¯•èƒ½åŠ›** | â­â­â­â­â­ | â­â­â­â­ | CDP è°ƒè¯•èƒ½åŠ›æ›´å¼º |

### 2.2 å…³é”®å·®å¼‚

```python
# CDP ä¼˜åŠ¿
âœ… æ€§èƒ½æ›´é«˜ï¼ˆæ— ä¸­é—´å±‚å¼€é”€ï¼‰
âœ… æ›´åº•å±‚ï¼Œæ§åˆ¶æ›´ç²¾ç»†
âœ… å®æ—¶äº‹ä»¶è®¢é˜…ï¼ˆåŒå‘é€šä¿¡ï¼‰
âœ… å¯ä»¥è®¿é—® Chrome çš„æ‰€æœ‰èƒ½åŠ›
âœ… å†…å­˜å ç”¨æ›´å°

# CDP åŠ£åŠ¿
âŒ åªæ”¯æŒ Chrome/Chromium
âŒ API å¤æ‚ï¼Œå­¦ä¹ æ›²çº¿é™¡å³­
âŒ éœ€è¦æ‰‹åŠ¨ç®¡ç†è¿æ¥ã€ä¼šè¯ã€ç”Ÿå‘½å‘¨æœŸ
âŒ é”™è¯¯å¤„ç†éœ€è¦è‡ªå·±å®ç°
âŒ æ²¡æœ‰å†…ç½®é‡è¯•ã€ç­‰å¾…æœºåˆ¶
âŒ æ–‡æ¡£åæŠ€æœ¯ï¼Œä¸å¤Ÿå‹å¥½

# Playwright ä¼˜åŠ¿
âœ… API ç®€å•å‹å¥½
âœ… è·¨æµè§ˆå™¨æ”¯æŒï¼ˆChromeã€Firefoxã€Safariï¼‰
âœ… å†…ç½®æ™ºèƒ½ç­‰å¾…ã€è‡ªåŠ¨é‡è¯•
âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
âœ… ä¼˜ç§€çš„æ–‡æ¡£å’Œç¤ºä¾‹
âœ… æ´»è·ƒçš„ç¤¾åŒº
âœ… å¼€ç®±å³ç”¨çš„æœ€ä½³å®è·µ
âœ… å†…ç½® Trace Viewerã€Inspector

# Playwright åŠ£åŠ¿
âŒ æœ‰ä¸­é—´å±‚å¼€é”€ï¼ˆPlaywright Serverï¼‰
âŒ æ€§èƒ½ç¨ä½äºåŸç”Ÿ CDP
âŒ æŸäº› CDP ç‰¹æ€§éœ€è¦ç»•è¿‡ API
âŒ å†…å­˜å ç”¨ç¨é«˜
```

---

## 3. æ€§èƒ½å¯¹æ¯”

### 3.1 å¯åŠ¨é€Ÿåº¦å¯¹æ¯”

```python
# æµ‹è¯•ç¯å¢ƒï¼šWindows 10, Python 3.11, Chrome 120

# CDP (cdp-use)
import time
from cdp_use import CDPClient

start = time.time()
client = CDPClient()
await client.connect('ws://127.0.0.1:9222/...')
print(f"CDP å¯åŠ¨: {time.time() - start:.3f}s")
# ç»“æœï¼šçº¦ 0.05-0.10s

# Playwright
from playwright.async_api import async_playwright

start = time.time()
async with async_playwright() as p:
    browser = await p.chromium.launch()
    page = await browser.new_page()
print(f"Playwright å¯åŠ¨: {time.time() - start:.3f}s")
# ç»“æœï¼šçº¦ 1.5-2.0sï¼ˆé¦–æ¬¡å¯åŠ¨ Playwright Serverï¼‰
# çƒ­å¯åŠ¨ï¼šçº¦ 0.3-0.5s
```

**ç»“è®º**ï¼šğŸŸ¢ **CDP å¯åŠ¨å¿« 3-10 å€**

---

### 3.2 DOM æ“ä½œæ€§èƒ½å¯¹æ¯”

```python
# æµ‹è¯•ï¼šè·å– 1000 ä¸ªå…ƒç´ çš„å±æ€§

# CDP æ–¹å¼
import asyncio

start = time.time()
for node_id in node_ids[:1000]:
    result = await cdp_client.send.DOM.getAttributes({
        'nodeId': node_id
    })
print(f"CDP: {time.time() - start:.3f}s")
# ç»“æœï¼šçº¦ 0.2-0.3s

# Playwright æ–¹å¼
start = time.time()
elements = await page.query_selector_all('*')
for el in elements[:1000]:
    attrs = await el.evaluate('el => [...el.attributes].map(a => [a.name, a.value])')
print(f"Playwright: {time.time() - start:.3f}s")
# ç»“æœï¼šçº¦ 0.4-0.6s
```

**ç»“è®º**ï¼šğŸŸ¢ **CDP æ‰¹é‡æ“ä½œå¿« 30-50%**

---

### 3.3 äº‹ä»¶ç›‘å¬æ€§èƒ½

```python
# CDP å®æ—¶äº‹ä»¶è®¢é˜…
await cdp_client.send.Network.enable()
await cdp_client.send.Page.enable()

# ç›‘å¬ç½‘ç»œè¯·æ±‚ï¼ˆå®æ—¶ï¼‰
@cdp_client.on('Network.requestWillBeSent')
async def on_request(event):
    print(f"Request: {event['request']['url']}")
    # å»¶è¿Ÿï¼š< 1ms

# Playwright äº‹ä»¶ç›‘å¬
page.on('request', lambda request: print(f"Request: {request.url}"))
# å»¶è¿Ÿï¼š5-10msï¼ˆéœ€è¦é€šè¿‡ Playwright Server è½¬å‘ï¼‰
```

**ç»“è®º**ï¼šğŸŸ¢ **CDP äº‹ä»¶å“åº”å¿« 5-10 å€**

---

### 3.4 å†…å­˜å ç”¨å¯¹æ¯”

```python
# æµ‹è¯•ï¼šæ‰“å¼€ 10 ä¸ªæ ‡ç­¾é¡µ

# CDP (cdp-use)
å†…å­˜å ç”¨ï¼š
- Chrome è¿›ç¨‹ï¼šçº¦ 150-200 MB/tab
- Python è¿›ç¨‹ï¼šçº¦ 50-80 MBï¼ˆæ€»è®¡ï¼Œæ‰€æœ‰ tab å…±äº«ï¼‰
æ€»è®¡ï¼šçº¦ 1.5-2.0 GB (10 tabs)

# Playwright
å†…å­˜å ç”¨ï¼š
- Chrome è¿›ç¨‹ï¼šçº¦ 150-200 MB/tab
- Playwright Serverï¼šçº¦ 100-150 MB
- Python è¿›ç¨‹ï¼šçº¦ 80-120 MB
æ€»è®¡ï¼šçº¦ 1.8-2.3 GB (10 tabs)
```

**ç»“è®º**ï¼šğŸŸ¢ **CDP å†…å­˜å ç”¨ä½ 10-15%**

---

### 3.5 æ€§èƒ½æ€»ç»“

| æŒ‡æ ‡ | CDP | Playwright | å·®å¼‚ | é‡è¦æ€§ |
|------|-----|-----------|------|--------|
| å¯åŠ¨é€Ÿåº¦ | 0.05-0.10s | 0.3-2.0s | **CDP å¿« 3-10x** | â­â­â­ |
| DOM æ“ä½œ | 0.2-0.3s | 0.4-0.6s | **CDP å¿« 30-50%** | â­â­â­â­ |
| äº‹ä»¶å“åº” | < 1ms | 5-10ms | **CDP å¿« 5-10x** | â­â­â­â­â­ |
| å†…å­˜å ç”¨ | ä½ | ç¨é«˜ | **CDP çœ 10-15%** | â­â­ |

**æ€§èƒ½ç»“è®º**ï¼šğŸŸ¢ **CDP åœ¨æ€§èƒ½ä¸Šæœ‰æ˜æ˜¾ä¼˜åŠ¿**

---

## 4. åŠŸèƒ½å®Œæ•´æ€§å¯¹æ¯”

### 4.1 åŸºç¡€åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | CDP | Playwright | è¯´æ˜ |
|------|-----|-----------|------|
| **é¡µé¢å¯¼èˆª** | âœ… | âœ… | éƒ½æ”¯æŒ |
| **å…ƒç´ å®šä½** | âœ… | âœ… | Playwright æ›´ç®€å• |
| **ç‚¹å‡»/è¾“å…¥** | âœ… | âœ… | Playwright æœ‰æ™ºèƒ½ç­‰å¾… |
| **æˆªå›¾** | âœ… | âœ… | åŠŸèƒ½ç›¸å½“ |
| **JavaScript æ‰§è¡Œ** | âœ… | âœ… | åŠŸèƒ½ç›¸å½“ |
| **Cookie ç®¡ç†** | âœ… | âœ… | Playwright æ›´æ–¹ä¾¿ |
| **ç½‘ç»œæ‹¦æˆª** | âœ… | âœ… | CDP æ›´çµæ´» |
| **æ–‡ä»¶ä¸Šä¼ ** | âœ… | âœ… | Playwright æ›´ç®€å• |
| **æ–‡ä»¶ä¸‹è½½** | âœ… | âœ… | Playwright è‡ªåŠ¨ç®¡ç† |
| **å¤šæ ‡ç­¾ç®¡ç†** | âœ… | âœ… | åŠŸèƒ½ç›¸å½“ |

### 4.2 é«˜çº§åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | CDP | Playwright | è¯´æ˜ |
|------|-----|-----------|------|
| **iframe å¤„ç†** | âœ… æ‰‹åŠ¨ | âœ… è‡ªåŠ¨ | Playwright æ›´ç®€å• |
| **Shadow DOM** | âœ… | âœ… | Playwright æœ‰ç©¿é€é€‰æ‹©å™¨ |
| **Service Worker** | âœ… | âœ… | CDP æ§åˆ¶æ›´ç»† |
| **æ€§èƒ½åˆ†æ** | âœ…âœ…âœ… | âœ… | CDP æ›´å¼ºå¤§ |
| **ç½‘ç»œæ—¥å¿—** | âœ…âœ…âœ… | âœ… | CDP æ›´è¯¦ç»† |
| **Coverage** | âœ… | âœ… | åŠŸèƒ½ç›¸å½“ |
| **è®¾å¤‡æ¨¡æ‹Ÿ** | âœ… | âœ… | Playwright æ›´æ–¹ä¾¿ |
| **åœ°ç†ä½ç½®** | âœ… | âœ… | åŠŸèƒ½ç›¸å½“ |
| **æƒé™æ§åˆ¶** | âœ… | âœ… | åŠŸèƒ½ç›¸å½“ |
| **è®¤è¯æ‹¦æˆª** | âœ… | âœ… | åŠŸèƒ½ç›¸å½“ |

### 4.3 AeroTest AI å…³é”®åŠŸèƒ½å¯¹æ¯”

| AeroTest AI éœ€æ±‚ | CDP | Playwright | æ¨è |
|-----------------|-----|-----------|------|
| **DOM æ ‘æå–** | âœ…âœ…âœ… å®Œæ•´ | âœ…âœ… éƒ¨åˆ† | CDP |
| **Accessibility Tree** | âœ…âœ…âœ… å®Œæ•´ | âœ… éƒ¨åˆ† | CDP |
| **è®¡ç®—æ ·å¼** | âœ…âœ…âœ… å…¨éƒ¨ | âœ…âœ… éƒ¨åˆ† | CDP |
| **è¾¹ç•Œæ¡†** | âœ…âœ…âœ… ç²¾ç¡® | âœ…âœ… ç²¾ç¡® | ç›¸å½“ |
| **å…ƒç´ äº‹ä»¶ç›‘å¬å™¨** | âœ…âœ…âœ… å®Œæ•´ | âŒ ä¸æ”¯æŒ | **CDP** |
| **ç»˜åˆ¶é¡ºåº** | âœ…âœ…âœ… z-index | âš ï¸ éš¾ | **CDP** |
| **å®æ—¶äº‹ä»¶** | âœ…âœ…âœ… åŸç”Ÿ | âœ… æœ‰å»¶è¿Ÿ | CDP |
| **iframe è·¨åŸŸ** | âœ… æ‰‹åŠ¨ | âœ… è‡ªåŠ¨ | Playwright |
| **å¤šæµè§ˆå™¨** | âŒ ä»… Chrome | âœ…âœ…âœ… å…¨éƒ¨ | Playwright |

**å…³é”®å‘ç°**ï¼š
- ğŸŸ¢ **DOM åˆ†æèƒ½åŠ›**ï¼šCDP > Playwright
- ğŸŸ¢ **å®æ—¶äº‹ä»¶ç›‘å¬**ï¼šCDP > Playwright
- ğŸŸ¢ **å…ƒç´ äº‹ä»¶æ£€æµ‹**ï¼šCDP ç‹¬æœ‰ï¼ˆPlaywright ä¸æ”¯æŒï¼‰
- ğŸ”´ **è·¨æµè§ˆå™¨**ï¼šPlaywright ç‹¬æœ‰

---

## 5. å¼€å‘ä½“éªŒå¯¹æ¯”

### 5.1 ä»£ç å¤æ‚åº¦å¯¹æ¯”

#### ç¤ºä¾‹ 1ï¼šæ‰“å¼€é¡µé¢å¹¶ç‚¹å‡»æŒ‰é’®

```python
# ============ CDP æ–¹å¼ ============
from cdp_use import CDPClient

# 1. å¯åŠ¨ Chromeï¼ˆéœ€è¦æ‰‹åŠ¨å¯åŠ¨ï¼‰
# chrome --remote-debugging-port=9222

# 2. è¿æ¥
client = CDPClient()
await client.connect('ws://127.0.0.1:9222/devtools/browser/...')

# 3. åˆ›å»º Target
result = await client.send.Target.createTarget({
    'url': 'https://example.com'
})
target_id = result['targetId']

# 4. é™„åŠ åˆ° Target
result = await client.send.Target.attachToTarget({
    'targetId': target_id,
    'flatten': True
})
session_id = result['sessionId']

# 5. å¯ç”¨å¿…è¦çš„ Domain
await client.send.Page.enable(session_id=session_id)
await client.send.DOM.enable(session_id=session_id)
await client.send.Runtime.enable(session_id=session_id)

# 6. ç­‰å¾…é¡µé¢åŠ è½½ï¼ˆæ‰‹åŠ¨ï¼‰
await asyncio.sleep(2)  # æˆ–è€…ç›‘å¬ Page.loadEventFired

# 7. è·å– Document
result = await client.send.DOM.getDocument(session_id=session_id)
root_node_id = result['root']['nodeId']

# 8. æŸ¥è¯¢æŒ‰é’®
result = await client.send.DOM.querySelector({
    'nodeId': root_node_id,
    'selector': 'button'
}, session_id=session_id)
node_id = result['nodeId']

# 9. è·å–è¾¹ç•Œæ¡†
result = await client.send.DOM.getBoxModel({
    'nodeId': node_id
}, session_id=session_id)
box = result['model']['content']

# 10. è®¡ç®—ç‚¹å‡»åæ ‡
x = (box[0] + box[4]) / 2
y = (box[1] + box[5]) / 2

# 11. æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡»
await client.send.Input.dispatchMouseEvent({
    'type': 'mousePressed',
    'x': x,
    'y': y,
    'button': 'left',
    'clickCount': 1
}, session_id=session_id)

await client.send.Input.dispatchMouseEvent({
    'type': 'mouseReleased',
    'x': x,
    'y': y,
    'button': 'left',
    'clickCount': 1
}, session_id=session_id)

# ä»£ç è¡Œæ•°ï¼šçº¦ 50 è¡Œ
# å¤æ‚åº¦ï¼šâ­â­â­â­â­ æé«˜
# é”™è¯¯å¤„ç†ï¼šéœ€è¦è‡ªå·±å®ç°


# ============ Playwright æ–¹å¼ ============
from playwright.async_api import async_playwright

async with async_playwright() as p:
    browser = await p.chromium.launch()
    page = await browser.new_page()
    await page.goto('https://example.com')
    await page.click('button')
    await browser.close()

# ä»£ç è¡Œæ•°ï¼š6 è¡Œ
# å¤æ‚åº¦ï¼šâ­ æä½
# é”™è¯¯å¤„ç†ï¼šè‡ªåŠ¨å¤„ç†
```

**ç»“è®º**ï¼šğŸ”´ **Playwright ä»£ç é‡å°‘ 8-10 å€**

---

#### ç¤ºä¾‹ 2ï¼šç›‘å¬ç½‘ç»œè¯·æ±‚

```python
# ============ CDP æ–¹å¼ ============
from cdp_use import CDPClient

client = CDPClient()
await client.connect(...)

# 1. å¯ç”¨ Network Domain
await client.send.Network.enable(session_id=session_id)

# 2. è®¢é˜…äº‹ä»¶
requests = []

@client.on('Network.requestWillBeSent')
async def on_request(event):
    if event.get('sessionId') == session_id:
        requests.append({
            'url': event['request']['url'],
            'method': event['request']['method']
        })

@client.on('Network.responseReceived')
async def on_response(event):
    if event.get('sessionId') == session_id:
        request_id = event['requestId']
        # éœ€è¦æ‰‹åŠ¨åŒ¹é… request å’Œ response
        # ...

# 3. å¯¼èˆª
await client.send.Page.navigate({
    'url': 'https://example.com'
}, session_id=session_id)

# 4. ç­‰å¾…å®Œæˆï¼ˆæ‰‹åŠ¨ï¼‰
await asyncio.sleep(5)

print(f"Total requests: {len(requests)}")

# ä»£ç è¡Œæ•°ï¼šçº¦ 30 è¡Œ
# å®æ—¶æ€§ï¼šâ­â­â­â­â­ ä¼˜ç§€ï¼ˆ< 1msï¼‰
# å¤æ‚åº¦ï¼šâ­â­â­â­ é«˜


# ============ Playwright æ–¹å¼ ============
from playwright.async_api import async_playwright

async with async_playwright() as p:
    browser = await p.chromium.launch()
    page = await browser.new_page()
    
    requests = []
    page.on('request', lambda req: requests.append({
        'url': req.url,
        'method': req.method
    }))
    
    await page.goto('https://example.com')
    print(f"Total requests: {len(requests)}")
    await browser.close()

# ä»£ç è¡Œæ•°ï¼š12 è¡Œ
# å®æ—¶æ€§ï¼šâ­â­â­ è‰¯å¥½ï¼ˆ5-10msï¼‰
# å¤æ‚åº¦ï¼šâ­ ä½
```

**ç»“è®º**ï¼š
- ğŸŸ¢ **CDP å®æ—¶æ€§æ›´å¥½**ï¼ˆ< 1ms vs 5-10msï¼‰
- ğŸ”´ **Playwright ä»£ç æ›´ç®€æ´**ï¼ˆ12 è¡Œ vs 30 è¡Œï¼‰

---

### 5.2 é”™è¯¯å¤„ç†å¯¹æ¯”

```python
# ============ CDP æ–¹å¼ ============
# éœ€è¦æ‰‹åŠ¨å¤„ç†å„ç§é”™è¯¯

try:
    result = await client.send.DOM.querySelector({
        'nodeId': root_node_id,
        'selector': 'button'
    }, session_id=session_id)
    
    if result['nodeId'] == 0:
        # å…ƒç´ ä¸å­˜åœ¨
        raise ElementNotFoundError()
    
except Exception as e:
    if 'No node with given id found' in str(e):
        # Node ID å¤±æ•ˆï¼ˆé¡µé¢åˆ·æ–°ç­‰ï¼‰
        # éœ€è¦é‡æ–°è·å– Document
        result = await client.send.DOM.getDocument(session_id=session_id)
        root_node_id = result['root']['nodeId']
        # é‡è¯•...
    elif 'Session not found' in str(e):
        # Session æ–­å¼€
        # éœ€è¦é‡æ–°é™„åŠ 
        # ...
    else:
        raise

# éœ€è¦å¤„ç†çš„é”™è¯¯ï¼š
# - Node ID å¤±æ•ˆ
# - Session æ–­å¼€
# - Target å…³é—­
# - è¶…æ—¶ï¼ˆæ‰‹åŠ¨å®ç°ï¼‰
# - å…ƒç´ ä¸å¯è§ï¼ˆæ‰‹åŠ¨æ£€æŸ¥ï¼‰
# - ç­‰ç­‰...


# ============ Playwright æ–¹å¼ ============
# å¤§éƒ¨åˆ†é”™è¯¯è‡ªåŠ¨å¤„ç†

try:
    await page.click('button', timeout=5000)
except TimeoutError:
    # å”¯ä¸€éœ€è¦å¤„ç†çš„é”™è¯¯
    print("Button not found or not clickable")

# Playwright è‡ªåŠ¨å¤„ç†ï¼š
# âœ… ç­‰å¾…å…ƒç´ å‡ºç°
# âœ… ç­‰å¾…å…ƒç´ å¯è§
# âœ… ç­‰å¾…å…ƒç´ ç¨³å®šï¼ˆä¸ç§»åŠ¨ï¼‰
# âœ… æ»šåŠ¨åˆ°å…ƒç´ 
# âœ… å…ƒç´ è¢«é®æŒ¡æ—¶æŠ¥é”™
# âœ… Session ç®¡ç†
# âœ… è‡ªåŠ¨é‡è¯•
```

**ç»“è®º**ï¼šğŸ”´ **Playwright é”™è¯¯å¤„ç†ç®€å• 10 å€**

---

### 5.3 è°ƒè¯•ä½“éªŒå¯¹æ¯”

```python
# ============ CDP æ–¹å¼ ============
# ä¼˜åŠ¿ï¼š
âœ… å¯ä»¥ä½¿ç”¨ Chrome DevTools å®æ—¶æŸ¥çœ‹
âœ… å®Œæ•´çš„ CDP æ—¥å¿—
âœ… å¯ä»¥æ‰‹åŠ¨å‘é€ CDP å‘½ä»¤æµ‹è¯•

# åŠ£åŠ¿ï¼š
âŒ éœ€è¦ç†è§£ CDP åè®®
âŒ é”™è¯¯ä¿¡æ¯ä¸å¤Ÿå‹å¥½
âŒ æ²¡æœ‰å¯è§†åŒ–å·¥å…·


# ============ Playwright æ–¹å¼ ============
# ä¼˜åŠ¿ï¼š
âœ… Playwright Inspectorï¼ˆå¯è§†åŒ–è°ƒè¯•ï¼‰
âœ… Trace Viewerï¼ˆå½•åˆ¶å›æ”¾ï¼‰
âœ… æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
âœ… æˆªå›¾å’Œè§†é¢‘å½•åˆ¶
âœ… Codegenï¼ˆå½•åˆ¶ç”Ÿæˆä»£ç ï¼‰

# åŠ£åŠ¿ï¼š
âŒ æ— æ³•ç›´æ¥æŸ¥çœ‹åº•å±‚ CDP å‘½ä»¤ï¼ˆéœ€è¦è°ƒè¯•æ—¥å¿—ï¼‰
```

**ç»“è®º**ï¼šğŸ”´ **Playwright è°ƒè¯•ä½“éªŒæ›´å¥½**

---

### 5.4 å­¦ä¹ æ›²çº¿å¯¹æ¯”

```
CDP å­¦ä¹ æ›²çº¿ï¼š
ğŸ“š éœ€è¦å­¦ä¹ å†…å®¹ï¼š
1. CDP åè®®è§„èŒƒï¼ˆ100+ é¡µï¼‰
2. Domain æ¦‚å¿µï¼ˆPageã€DOMã€Networkã€Runtime ç­‰ï¼‰
3. Target å’Œ Session ç®¡ç†
4. äº‹ä»¶è®¢é˜…æœºåˆ¶
5. Node ID ç”Ÿå‘½å‘¨æœŸ
6. æ‰‹åŠ¨ç­‰å¾…å’Œé‡è¯•é€»è¾‘
7. é”™è¯¯ç±»å‹å’Œå¤„ç†

é¢„è®¡å­¦ä¹ æ—¶é—´ï¼š2-4 å‘¨
é€‚åˆäººç¾¤ï¼šæœ‰æµè§ˆå™¨åº•å±‚ç»éªŒçš„å¼€å‘è€…


Playwright å­¦ä¹ æ›²çº¿ï¼š
ğŸ“š éœ€è¦å­¦ä¹ å†…å®¹ï¼š
1. Playwright APIï¼ˆç±»ä¼¼ Seleniumï¼‰
2. é€‰æ‹©å™¨è¯­æ³•
3. åŸºç¡€å¼‚æ­¥ç¼–ç¨‹

é¢„è®¡å­¦ä¹ æ—¶é—´ï¼š3-5 å¤©
é€‚åˆäººç¾¤ï¼šä»»ä½•æœ‰ç¼–ç¨‹ç»éªŒçš„å¼€å‘è€…
```

**ç»“è®º**ï¼šğŸ”´ **Playwright å­¦ä¹ æ›²çº¿ä½ 5-10 å€**

---

### 5.5 å¼€å‘æ•ˆç‡å¯¹æ¯”

| ä»»åŠ¡ | CDP å¼€å‘æ—¶é—´ | Playwright å¼€å‘æ—¶é—´ | å·®å¼‚ |
|------|------------|-------------------|------|
| ç®€å•å¯¼èˆªç‚¹å‡» | 2 å°æ—¶ | 15 åˆ†é’Ÿ | **8x** |
| ç½‘ç»œæ‹¦æˆª | 4 å°æ—¶ | 30 åˆ†é’Ÿ | **8x** |
| iframe å¤„ç† | 1 å¤© | 2 å°æ—¶ | **4x** |
| æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ | 3 å°æ—¶ | 30 åˆ†é’Ÿ | **6x** |
| é”™è¯¯å¤„ç†å®Œå–„ | 2 å¤© | 4 å°æ—¶ | **4x** |

**å¼€å‘æ•ˆç‡ç»“è®º**ï¼šğŸ”´ **Playwright å¼€å‘é€Ÿåº¦å¿« 4-8 å€**

---

## 6. ä¸ AeroTest AI éœ€æ±‚å¥‘åˆåº¦

### 6.1 äº”å±‚æ¼æ–—éœ€æ±‚åˆ†æ

#### L1 å±‚ï¼šè¯­ä¹‰æ§½è§„åˆ™å±‚
```python
éœ€æ±‚ï¼š
- å¿«é€Ÿè§£æç”¨æˆ·æŒ‡ä»¤
- å˜é‡æ³¨å…¥
- åŠ¨ä½œæ˜ å°„

CDP vs Playwrightï¼š
- ä¸æµè§ˆå™¨é©±åŠ¨æ— å…³
- âœ…âœ… ä¸¤è€…éƒ½é€‚ç”¨
```

#### L2 å±‚ï¼šç»“æ„åŒ–å±æ€§ç¡¬åŒ¹é…
```python
éœ€æ±‚ï¼š
- æå– DOM å±æ€§ï¼ˆplaceholderã€aria-labelã€idã€nameã€innerTextï¼‰
- æ¨¡ç³Šå­—ç¬¦ä¸²åŒ¹é…
- å¿«é€Ÿå“åº”ï¼ˆ< 200msï¼‰

CDP å®ç°ï¼š
âœ… å¯ä»¥è·å–æ‰€æœ‰ DOM å±æ€§
âœ… é€šè¿‡ DOM.getAttributes æ‰¹é‡è·å–
âœ… æ€§èƒ½ä¼˜ç§€ï¼ˆ150-200msï¼‰
âš ï¸ éœ€è¦æ‰‹åŠ¨éå† DOM æ ‘

Playwright å®ç°ï¼š
âœ… é€šè¿‡ evaluate è·å–å±æ€§
âœ… å†…ç½®é€‰æ‹©å™¨å¼•æ“
âš ï¸ æ€§èƒ½ç¨ä½ï¼ˆ200-300msï¼‰
âœ… ä»£ç ç®€å•

æ¨èï¼šâœ… Playwrightï¼ˆæ€§èƒ½å·®å¼‚å¯æ¥å—ï¼Œä»£ç ç®€å•ï¼‰
```

#### L3 å±‚ï¼šç©ºé—´å¸ƒå±€é”šç‚¹å±‚
```python
éœ€æ±‚ï¼š
- é”šç‚¹å®šä½
- é‚»è¿‘æ¢æµ‹ï¼ˆä½ç½®å…³ç³»ï¼‰
- è¾¹ç•Œæ¡†è®¡ç®—
- äº‹ä»¶ç›‘å¬å™¨æ£€æµ‹

CDP å®ç°ï¼š
âœ…âœ…âœ… DOM.getBoxModelï¼ˆç²¾ç¡®è¾¹ç•Œæ¡†ï¼‰
âœ…âœ…âœ… DOMDebugger.getEventListenersï¼ˆæ£€æµ‹äº‹ä»¶ï¼‰â˜… ç‹¬æœ‰
âœ…âœ…âœ… Runtime.evaluateï¼ˆä½ç½®è®¡ç®—ï¼‰
âœ… æ€§èƒ½ä¼˜ç§€

Playwright å®ç°ï¼š
âœ…âœ… element.bounding_box()ï¼ˆç²¾ç¡®è¾¹ç•Œæ¡†ï¼‰
âŒâŒ æ— æ³•è·å–äº‹ä»¶ç›‘å¬å™¨ â˜… è¿™æ˜¯å¤§é—®é¢˜
âœ… evaluate å¯ä»¥è®¡ç®—ä½ç½®
âœ… ä»£ç ç®€å•

å…³é”®é—®é¢˜ï¼š
Playwright æ— æ³•æ£€æµ‹å…ƒç´ æ˜¯å¦ç»‘å®šäº†äº‹ä»¶ç›‘å¬å™¨ï¼
è¿™å¯¹ L3 å±‚çš„"å±‚çº§ç©¿é€"åŠŸèƒ½æ˜¯è‡´å‘½çš„ã€‚

ç¤ºä¾‹ï¼š
<div>æ‰‹æœºå·</div>
<div onclick="handleClick()">  <!-- CDP å¯ä»¥æ£€æµ‹åˆ° onclick -->
    ç‚¹å‡»è¾“å…¥
</div>

æ¨èï¼šğŸŸ¢ CDPï¼ˆå› ä¸ºéœ€è¦äº‹ä»¶ç›‘å¬å™¨æ£€æµ‹ï¼‰
```

#### L4 å±‚ï¼šæ„å›¾æ¨ç†å±‚
```python
éœ€æ±‚ï¼š
- æå– DOM ç‰‡æ®µ
- å‘é€ç»™ LLM
- Token ä¼˜åŒ–

CDP vs Playwrightï¼š
âœ…âœ… ä¸¤è€…éƒ½å¯ä»¥æå– DOM
âœ…âœ… æ€§èƒ½ç›¸å½“
âœ… Playwright ä»£ç æ›´ç®€å•

æ¨èï¼šâœ… ä¸¤è€…éƒ½å¯ä»¥
```

#### L5 å±‚ï¼šå¤šæ¨¡æ€è§†è§‰æ„ŸçŸ¥å±‚
```python
éœ€æ±‚ï¼š
- æˆªå›¾
- åæ ‡ç‚¹å‡»

CDP å®ç°ï¼š
âœ… Page.captureScreenshot
âœ… Input.dispatchMouseEventï¼ˆåæ ‡ç‚¹å‡»ï¼‰
âœ… æ€§èƒ½ä¼˜ç§€

Playwright å®ç°ï¼š
âœ… page.screenshot()
âœ… page.mouse.click(x, y)
âœ… ä»£ç æ›´ç®€å•

æ¨èï¼šâœ… ä¸¤è€…éƒ½å¯ä»¥ï¼ŒPlaywright æ›´ç®€å•
```

---

### 6.2 å…³é”®åŠŸèƒ½éœ€æ±‚å¯¹æ¯”

| AeroTest AI åŠŸèƒ½ | CDP | Playwright | å…³é”®å·®å¼‚ |
|-----------------|-----|-----------|---------|
| **DOM å±æ€§æå–** | âœ…âœ…âœ… | âœ…âœ… | CDP æ›´å¿«ä½†ä»£ç å¤æ‚ |
| **äº‹ä»¶ç›‘å¬å™¨æ£€æµ‹** | âœ…âœ…âœ… æ”¯æŒ | âŒâŒ ä¸æ”¯æŒ | **CDP ç‹¬æœ‰ï¼** |
| **è¾¹ç•Œæ¡†è®¡ç®—** | âœ…âœ…âœ… | âœ…âœ…âœ… | åŠŸèƒ½ç›¸å½“ |
| **iframe å¤„ç†** | âœ… æ‰‹åŠ¨ | âœ…âœ… è‡ªåŠ¨ | Playwright æ›´ç®€å• |
| **Shadow DOM** | âœ…âœ… | âœ…âœ…âœ… | Playwright ç©¿é€é€‰æ‹©å™¨ |
| **ç½‘ç»œç›‘å¬** | âœ…âœ…âœ… å®æ—¶ | âœ…âœ… æœ‰å»¶è¿Ÿ | CDP æ›´å¿« |
| **åæ ‡ç‚¹å‡»** | âœ…âœ…âœ… | âœ…âœ…âœ… | åŠŸèƒ½ç›¸å½“ |
| **Trace å½•åˆ¶** | âš ï¸ æ‰‹åŠ¨ | âœ…âœ…âœ… å†…ç½® | Playwright æ›´å¥½ |
| **é”™è¯¯æ¢å¤** | âš ï¸ æ‰‹åŠ¨ | âœ…âœ…âœ… è‡ªåŠ¨ | Playwright æ›´å¥½ |
| **å¤šæµè§ˆå™¨** | âŒ ä»… Chrome | âœ…âœ…âœ… å…¨æ”¯æŒ | Playwright ç‹¬æœ‰ |

### 6.3 å…³é”®ç»“è®º

ğŸ”´ **æœ€å¤§é—®é¢˜ï¼šPlaywright æ— æ³•æ£€æµ‹äº‹ä»¶ç›‘å¬å™¨**

```python
# L3 å±‚çš„æ ¸å¿ƒéœ€æ±‚ï¼šå±‚çº§ç©¿é€
éœ€æ±‚ï¼šè‡ªåŠ¨æ¢æµ‹è¯¥åŒºåŸŸå†…ç»‘å®šäº† Click æˆ– Input äº‹ä»¶ç›‘å¬å™¨çš„éæ ‡å‡†æ ‡ç­¾

# CDP å¯ä»¥å®ç°
result = await client.send.DOMDebugger.getEventListeners({
    'objectId': object_id
})
# è¿”å›ï¼š['click', 'input', 'mousedown', ...]

# Playwright æ— æ³•å®ç°
# æ²¡æœ‰å¯¹åº” APIï¼
# åªèƒ½é€šè¿‡ evaluate æ£€æµ‹ onclick å±æ€§ï¼Œä½†æ— æ³•æ£€æµ‹ addEventListener
```

è¿™æ˜¯ä¸€ä¸ª**è‡´å‘½ç¼ºé™·**ï¼Œå› ä¸ºï¼š
1. ç°ä»£ Web åº”ç”¨å¤§é‡ä½¿ç”¨ `addEventListener`
2. æ¡†æ¶ï¼ˆReactã€Vueï¼‰éƒ½ç”¨ `addEventListener`
3. æ— æ³•æ£€æµ‹äº‹ä»¶ç›‘å¬å™¨ = L3 å±‚åŠŸèƒ½æ®‹ç¼º

---

## 7. æˆæœ¬åˆ†æ

### 7.1 å¼€å‘æˆæœ¬

```python
# å‡è®¾å¼€å‘ä¸€ä¸ªå®Œæ•´çš„äº”å±‚æ¼æ–—å¼•æ“

CDP æ–¹æ¡ˆï¼š
-----------------
å­¦ä¹ æˆæœ¬ï¼š2-4 å‘¨
å¼€å‘æ—¶é—´ï¼š
- Browser ç®¡ç†ï¼š2-3 å‘¨
- DOM æå–ï¼š2-3 å‘¨
- L1-L3 å±‚ï¼š3-4 å‘¨
- L4-L5 å±‚ï¼š2 å‘¨
- é”™è¯¯å¤„ç†å’Œç¨³å®šæ€§ï¼š2-3 å‘¨
- æµ‹è¯•å’Œä¼˜åŒ–ï¼š2 å‘¨
æ€»è®¡ï¼š13-19 å‘¨

å¼€å‘éš¾åº¦ï¼šâ­â­â­â­â­


Playwright æ–¹æ¡ˆï¼š
-----------------
å­¦ä¹ æˆæœ¬ï¼š3-5 å¤©
å¼€å‘æ—¶é—´ï¼š
- Browser ç®¡ç†ï¼š3-5 å¤©ï¼ˆä½¿ç”¨ç°æˆ APIï¼‰
- DOM æå–ï¼š1-2 å‘¨
- L1-L3 å±‚ï¼š2-3 å‘¨ï¼ˆä½† L3 æœ‰ç¼ºé™·ï¼‰
- L4-L5 å±‚ï¼š1-2 å‘¨
- é”™è¯¯å¤„ç†å’Œç¨³å®šæ€§ï¼š5-7 å¤©ï¼ˆå¤§éƒ¨åˆ†è‡ªåŠ¨ï¼‰
- æµ‹è¯•å’Œä¼˜åŒ–ï¼š1 å‘¨
æ€»è®¡ï¼š6-9 å‘¨

å¼€å‘éš¾åº¦ï¼šâ­â­


æ··åˆæ–¹æ¡ˆï¼ˆPlaywright + CDP è¡¥å……ï¼‰ï¼š
---------------------------------
æ ¸å¿ƒä½¿ç”¨ï¼šPlaywright
å…³é”®åŠŸèƒ½ï¼šCDP è¡¥å……ï¼ˆäº‹ä»¶ç›‘å¬å™¨æ£€æµ‹ï¼‰

å­¦ä¹ æˆæœ¬ï¼š1 å‘¨
å¼€å‘æ—¶é—´ï¼š
- Browser ç®¡ç†ï¼š3-5 å¤©ï¼ˆPlaywrightï¼‰
- DOM æå–ï¼š1-2 å‘¨ï¼ˆPlaywright + CDP æ··åˆï¼‰
- L1-L3 å±‚ï¼š2-3 å‘¨ï¼ˆL3 ç”¨ CDP æ£€æµ‹äº‹ä»¶ï¼‰
- L4-L5 å±‚ï¼š1-2 å‘¨
- é”™è¯¯å¤„ç†ï¼š5-7 å¤©
- æµ‹è¯•å’Œä¼˜åŒ–ï¼š1 å‘¨
æ€»è®¡ï¼š7-10 å‘¨

å¼€å‘éš¾åº¦ï¼šâ­â­â­
```

### 7.2 ç»´æŠ¤æˆæœ¬

```python
CDP æ–¹æ¡ˆï¼š
---------
ç»´æŠ¤éš¾åº¦ï¼šâ­â­â­â­â­ æé«˜
åŸå› ï¼š
- å¤§é‡åº•å±‚ä»£ç éœ€è¦ç»´æŠ¤
- é”™è¯¯å¤„ç†å¤æ‚
- æµè§ˆå™¨æ›´æ–°å¯èƒ½ç ´ååŠŸèƒ½
- éœ€è¦æ·±å…¥ç†è§£ CDP åè®®
- æ–°äººä¸Šæ‰‹å›°éš¾

å¹´ç»´æŠ¤å·¥æ—¶ï¼š200-300 å°æ—¶


Playwright æ–¹æ¡ˆï¼š
----------------
ç»´æŠ¤éš¾åº¦ï¼šâ­â­ ä½
åŸå› ï¼š
- ä»£ç ç®€æ´
- æ¡†æ¶è‡ªåŠ¨å¤„ç†å¤§éƒ¨åˆ†é—®é¢˜
- ç¤¾åŒºæ´»è·ƒï¼Œé—®é¢˜å®¹æ˜“è§£å†³
- æ–°äººä¸Šæ‰‹å¿«

å¹´ç»´æŠ¤å·¥æ—¶ï¼š50-80 å°æ—¶


æ··åˆæ–¹æ¡ˆï¼š
---------
ç»´æŠ¤éš¾åº¦ï¼šâ­â­â­ ä¸­
åŸå› ï¼š
- ä¸»è¦ä»£ç åŸºäº Playwrightï¼ˆç®€å•ï¼‰
- å°‘é‡ CDP ä»£ç éœ€è¦ç»´æŠ¤
- éœ€è¦ç»´æŠ¤ä¸¤å¥— API çš„é›†æˆ

å¹´ç»´æŠ¤å·¥æ—¶ï¼š80-120 å°æ—¶
```

### 7.3 æ€§èƒ½æˆæœ¬

```python
åœ¨ç”Ÿäº§ç¯å¢ƒå¹¶å‘ 100 ä¸ªæµè§ˆå™¨å®ä¾‹ï¼š

CDP æ–¹æ¡ˆï¼š
---------
å†…å­˜ï¼š100 å®ä¾‹ Ã— 300 MB = 30 GB
CPUï¼šä¸­ç­‰ï¼ˆäº‹ä»¶å¤„ç†å¼€é”€å°ï¼‰
å¯åŠ¨æ—¶é—´ï¼š100 Ã— 0.1s = 10s
æˆæœ¬ï¼šğŸ’°ğŸ’°ğŸ’° (æœåŠ¡å™¨æˆæœ¬)


Playwright æ–¹æ¡ˆï¼š
----------------
å†…å­˜ï¼š100 å®ä¾‹ Ã— 350 MB = 35 GB
CPUï¼šç¨é«˜ï¼ˆPlaywright Server å¼€é”€ï¼‰
å¯åŠ¨æ—¶é—´ï¼š100 Ã— 0.5s = 50s
æˆæœ¬ï¼šğŸ’°ğŸ’°ğŸ’°ğŸ’° (æœåŠ¡å™¨æˆæœ¬ç¨é«˜)


å·®å¼‚ï¼š
Playwright æˆæœ¬é«˜çº¦ 15-20%
ä½†åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œè¿™ä¸ªå·®å¼‚ä¸å¤§
```

---

## 8. æœ€ç»ˆå»ºè®®

### 8.1 å†³ç­–æ ‘

```
å¼€å§‹
  â”‚
  â”œâ”€ é—®é¢˜ 1ï¼šæ˜¯å¦éœ€è¦æ£€æµ‹å…ƒç´ äº‹ä»¶ç›‘å¬å™¨ï¼Ÿ
  â”‚    â”œâ”€ æ˜¯ â†’ CDP æˆ–æ··åˆæ–¹æ¡ˆ
  â”‚    â””â”€ å¦ â†’ Playwright
  â”‚
  â”œâ”€ é—®é¢˜ 2ï¼šæ˜¯å¦éœ€è¦æè‡´æ€§èƒ½ï¼ˆ< 100msï¼‰ï¼Ÿ
  â”‚    â”œâ”€ æ˜¯ â†’ CDP
  â”‚    â””â”€ å¦ â†’ Playwright
  â”‚
  â”œâ”€ é—®é¢˜ 3ï¼šå›¢é˜Ÿæ˜¯å¦ç†Ÿæ‚‰ CDP åè®®ï¼Ÿ
  â”‚    â”œâ”€ æ˜¯ â†’ CDP
  â”‚    â””â”€ å¦ â†’ Playwright
  â”‚
  â”œâ”€ é—®é¢˜ 4ï¼šæ˜¯å¦éœ€è¦è·¨æµè§ˆå™¨æ”¯æŒï¼Ÿ
  â”‚    â”œâ”€ æ˜¯ â†’ Playwright
  â”‚    â””â”€ å¦ â†’ ç»§ç»­
  â”‚
  â””â”€ é—®é¢˜ 5ï¼šå¼€å‘æ—¶é—´æ˜¯å¦ç´§å¼ ï¼Ÿ
       â”œâ”€ æ˜¯ â†’ Playwright
       â””â”€ å¦ â†’ CDP
```

### 8.2 é’ˆå¯¹ AeroTest AI çš„å»ºè®®

#### ğŸ¯ **æ¨èæ–¹æ¡ˆï¼šPlaywright ä¸ºä¸» + CDP è¡¥å……ï¼ˆæ··åˆæ–¹æ¡ˆï¼‰**

```python
æ¶æ„è®¾è®¡ï¼š
==========

1. ä¸»é©±åŠ¨ï¼šPlaywright
   ç”¨é€”ï¼š
   âœ… Browser ç®¡ç†
   âœ… é¡µé¢å¯¼èˆª
   âœ… åŸºç¡€å…ƒç´ æ“ä½œ
   âœ… æˆªå›¾ã€å½•åˆ¶
   âœ… iframe å¤„ç†
   âœ… é”™è¯¯å¤„ç†

2. CDP è¡¥å……ï¼šcdp-use
   ç”¨é€”ï¼š
   âœ… äº‹ä»¶ç›‘å¬å™¨æ£€æµ‹ï¼ˆL3 å±‚å…³é”®åŠŸèƒ½ï¼‰
   âœ… å®æ—¶ç½‘ç»œç›‘å¬ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
   âœ… é«˜çº§ DOM åˆ†æï¼ˆå¯é€‰ï¼‰

é›†æˆæ–¹å¼ï¼š
==========

# Playwright é¡µé¢å¯¹è±¡åŒ…å« CDP å®¢æˆ·ç«¯
from playwright.async_api import Page
from cdp_use import CDPClient

class EnhancedPage:
    def __init__(self, playwright_page: Page):
        self.page = playwright_page
        
        # è·å– CDP Sessionï¼ˆPlaywright æä¾›ï¼‰
        cdp_session = await self.page.context.new_cdp_session(self.page)
        self.cdp = CDPClient(session=cdp_session)
    
    async def has_event_listeners(self, element) -> list[str]:
        """æ£€æµ‹å…ƒç´ äº‹ä»¶ç›‘å¬å™¨ï¼ˆCDP ç‹¬æœ‰åŠŸèƒ½ï¼‰"""
        # ä½¿ç”¨ CDP
        object_id = await element.evaluate_handle('el => el')
        result = await self.cdp.send.DOMDebugger.getEventListeners({
            'objectId': object_id
        })
        return [listener['type'] for listener in result['listeners']]
    
    async def click(self, selector: str):
        """æ­£å¸¸ç‚¹å‡»ï¼ˆä½¿ç”¨ Playwrightï¼‰"""
        await self.page.click(selector)
    
    async def goto(self, url: str):
        """å¯¼èˆªï¼ˆä½¿ç”¨ Playwrightï¼‰"""
        await self.page.goto(url)


# L3 å±‚ä½¿ç”¨æ··åˆæ–¹æ¡ˆ
class L3SpatialLayout:
    async def find_by_spatial_layout(self, page: EnhancedPage, anchor_text: str):
        # 1. ä½¿ç”¨ Playwright æ‰¾åˆ°é”šç‚¹
        anchor = await page.page.locator(f'text={anchor_text}').first
        
        # 2. ä½¿ç”¨ Playwright è·å–è¾¹ç•Œæ¡†
        anchor_box = await anchor.bounding_box()
        
        # 3. ä½¿ç”¨ Playwright æŸ¥è¯¢é‚»è¿‘å…ƒç´ 
        nearby_elements = await page.page.evaluate(f'''
            () => {{
                // æŸ¥æ‰¾é‚»è¿‘å…ƒç´ çš„ JS
                // ...
                return elements;
            }}
        ''')
        
        # 4. ä½¿ç”¨ CDP æ£€æµ‹äº‹ä»¶ç›‘å¬å™¨ï¼ˆå…³é”®ï¼ï¼‰
        for element in nearby_elements:
            listeners = await page.has_event_listeners(element)
            if 'click' in listeners or 'input' in listeners:
                return element
        
        return None
```

### 8.3 æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | å¼€å‘æ—¶é—´ | ç»´æŠ¤æˆæœ¬ | æ€§èƒ½ | åŠŸèƒ½å®Œæ•´æ€§ | æ¨èåº¦ |
|------|---------|---------|------|-----------|--------|
| **çº¯ CDP** | 13-19å‘¨ | æé«˜ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­ |
| **çº¯ Playwright** | 6-9å‘¨ | ä½ | â­â­â­â­ | â­â­â­â­ (L3ç¼ºé™·) | â­â­â­ |
| **æ··åˆæ–¹æ¡ˆ** | 7-10å‘¨ | ä¸­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |

### 8.4 æ··åˆæ–¹æ¡ˆä¼˜åŠ¿

```python
ä¼˜åŠ¿ï¼š
=====
âœ… å¼€å‘æ•ˆç‡ï¼šPlaywright æä¾›é«˜å±‚ APIï¼Œå¿«é€Ÿå¼€å‘
âœ… åŠŸèƒ½å®Œæ•´ï¼šCDP è¡¥å……å…³é”®ç¼ºå¤±åŠŸèƒ½ï¼ˆäº‹ä»¶ç›‘å¬å™¨æ£€æµ‹ï¼‰
âœ… æ€§èƒ½ä¼˜ç§€ï¼šå…³é”®è·¯å¾„ï¼ˆäº‹ä»¶æ£€æµ‹ï¼‰ä½¿ç”¨ CDP
âœ… ç»´æŠ¤ç®€å•ï¼š80% ä»£ç åŸºäº Playwrightï¼ˆç®€å•ï¼‰
âœ… çµæ´»æ€§ï¼šå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©ä½¿ç”¨ Playwright æˆ– CDP
âœ… è·¨æµè§ˆå™¨ï¼šPlaywright æä¾›è·¨æµè§ˆå™¨èƒ½åŠ›ï¼ˆæœªæ¥æ‰©å±•ï¼‰
âœ… ç”Ÿæ€ç³»ç»Ÿï¼šä¸¤ä¸ªç”Ÿæ€ç³»ç»Ÿçš„ä¼˜åŠ¿éƒ½èƒ½åˆ©ç”¨

åŠ£åŠ¿ï¼š
=====
âš ï¸ å¤æ‚åº¦ç¨é«˜ï¼šéœ€è¦ç»´æŠ¤ä¸¤å¥— API
âš ï¸ å­¦ä¹ æˆæœ¬ï¼šéœ€è¦å­¦ä¹ ä¸¤ç§æŠ€æœ¯ï¼ˆä½†åªæ˜¯éƒ¨åˆ† CDPï¼‰
âš ï¸ ä¾èµ–ï¼šéœ€è¦åŒæ—¶ä¾èµ– Playwright å’Œ CDP åº“

é£é™©ç¼“è§£ï¼š
=========
âœ… å°† CDP ä½¿ç”¨é™åˆ¶åœ¨å°‘æ•°å…³é”®åœºæ™¯
âœ… å°è£…ç»Ÿä¸€æ¥å£ï¼ˆEnhancedPageï¼‰
âœ… è¯¦ç»†æ–‡æ¡£è¯´æ˜ä½•æ—¶ä½¿ç”¨å“ªç§ API
âœ… åªä½¿ç”¨ CDP çš„ç¨³å®šåŠŸèƒ½
```

### 8.5 å®æ–½å»ºè®®

#### é˜¶æ®µ 1ï¼šåŸºäº Playwright æ„å»ºæ ¸å¿ƒï¼ˆ4-6 å‘¨ï¼‰
```python
ä»»åŠ¡ï¼š
â–¡ ä½¿ç”¨ Playwright å®ç° Browser ç®¡ç†
â–¡ ä½¿ç”¨ Playwright å®ç° L1-L2 å±‚
â–¡ ä½¿ç”¨ Playwright å®ç°åŸºç¡€ L3 å±‚ï¼ˆä¸å«äº‹ä»¶æ£€æµ‹ï¼‰
â–¡ å®ç° L4-L5 å±‚

äº§å‡ºï¼š
- 90% åŠŸèƒ½å®Œæˆ
- L3 å±‚æœ‰é™åˆ¶ï¼ˆæ— äº‹ä»¶æ£€æµ‹ï¼‰
```

#### é˜¶æ®µ 2ï¼šCDP å¢å¼ºå…³é”®åŠŸèƒ½ï¼ˆ1-2 å‘¨ï¼‰
```python
ä»»åŠ¡ï¼š
â–¡ é›†æˆ CDP Session
â–¡ å®ç°äº‹ä»¶ç›‘å¬å™¨æ£€æµ‹
â–¡ ä¼˜åŒ–ç½‘ç»œç›‘å¬ï¼ˆå¯é€‰ï¼‰
â–¡ å°è£… EnhancedPage æ¥å£

äº§å‡ºï¼š
- L3 å±‚å®Œæ•´åŠŸèƒ½
- ç»Ÿä¸€æ¥å£
```

#### é˜¶æ®µ 3ï¼šæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ1-2 å‘¨ï¼‰
```python
ä»»åŠ¡ï¼š
â–¡ æ€§èƒ½æµ‹è¯•
â–¡ ç¨³å®šæ€§æµ‹è¯•
â–¡ çœŸå®åœºæ™¯æµ‹è¯•
â–¡ ä¼˜åŒ–æ··åˆè°ƒç”¨

äº§å‡ºï¼š
- ç”Ÿäº§å°±ç»ª
- æ€§èƒ½æŠ¥å‘Š
```

### 8.6 æŠ€æœ¯å€ºåŠ¡è¯„ä¼°

```python
çº¯ CDP æ–¹æ¡ˆï¼š
æŠ€æœ¯å€ºåŠ¡ï¼šâ­â­â­â­â­ æé«˜
- å¤§é‡åº•å±‚ä»£ç 
- å¤æ‚çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- é”™è¯¯å¤„ç†å¤æ‚
- ç»´æŠ¤æˆæœ¬é«˜

çº¯ Playwright æ–¹æ¡ˆï¼š
æŠ€æœ¯å€ºåŠ¡ï¼šâ­â­ ä½
- ä»£ç ç®€æ´
- ä½† L3 å±‚åŠŸèƒ½æ®‹ç¼º
- æœªæ¥å¯èƒ½éœ€è¦é‡æ„

æ··åˆæ–¹æ¡ˆï¼š
æŠ€æœ¯å€ºåŠ¡ï¼šâ­â­â­ ä¸­ç­‰
- æ¥å£å¤æ‚åº¦é€‚ä¸­
- CDP ä½¿ç”¨é™åˆ¶åœ¨å…³é”®åœºæ™¯
- å¯ç»´æŠ¤æ€§å¥½
- æœªæ¥å¯ä»¥é€æ­¥è¿ç§»åˆ° Playwrightï¼ˆå¦‚æœå®ƒè¡¥å……äº†ç¼ºå¤±åŠŸèƒ½ï¼‰
```

---

## 9. æ€»ç»“

### 9.1 æ ¸å¿ƒç»“è®º

1. **æ€§èƒ½**ï¼šğŸŸ¢ CDP > Playwrightï¼ˆå¿« 20-50%ï¼‰
2. **æ˜“ç”¨æ€§**ï¼šğŸ”´ Playwright >>> CDPï¼ˆç®€å• 5-10 å€ï¼‰
3. **åŠŸèƒ½å®Œæ•´æ€§**ï¼šğŸŸ¢ CDP â‰¥ Playwrightï¼ˆCDP æœ‰äº‹ä»¶æ£€æµ‹ï¼‰
4. **å¼€å‘æ•ˆç‡**ï¼šğŸ”´ Playwright >>> CDPï¼ˆå¿« 2-3 å€ï¼‰
5. **ç»´æŠ¤æˆæœ¬**ï¼šğŸ”´ Playwright < CDPï¼ˆä½ 3-4 å€ï¼‰

### 9.2 å…³é”®å‘ç°

```
ğŸ”´ è‡´å‘½é—®é¢˜ï¼š
Playwright æ— æ³•æ£€æµ‹å…ƒç´ çš„äº‹ä»¶ç›‘å¬å™¨
è¿™å¯¹ L3 å±‚çš„"å±‚çº§ç©¿é€"åŠŸèƒ½æ˜¯ä¸¥é‡é™åˆ¶

ğŸŸ¢ è§£å†³æ–¹æ¡ˆï¼š
æ··åˆä½¿ç”¨ Playwright + CDP
- Playwrightï¼šä¸»é©±åŠ¨ï¼ˆ80% ä»£ç ï¼‰
- CDPï¼šè¡¥å……å…³é”®åŠŸèƒ½ï¼ˆ20% ä»£ç ï¼‰
```

### 9.3 æœ€ç»ˆæ¨è

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¨èæ–¹æ¡ˆï¼šPlaywright + CDP æ··åˆæ–¹æ¡ˆ       â”‚
â”‚                                             â”‚
â”‚   ä¸»é©±åŠ¨ï¼šPlaywright                        â”‚
â”‚   - å¿«é€Ÿå¼€å‘                                â”‚
â”‚   - ç®€å•ç»´æŠ¤                                â”‚
â”‚   - å®Œå–„ç”Ÿæ€                                â”‚
â”‚                                             â”‚
â”‚   CDP è¡¥å……ï¼š                                â”‚
â”‚   - äº‹ä»¶ç›‘å¬å™¨æ£€æµ‹ï¼ˆL3 å±‚å…³é”®ï¼‰             â”‚
â”‚   - å®æ—¶ç½‘ç»œç›‘å¬ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰                â”‚
â”‚                                             â”‚
â”‚   ä¼˜åŠ¿ï¼š                                    â”‚
â”‚   âœ… å¼€å‘æ•ˆç‡é«˜ï¼ˆ7-10 å‘¨ vs 13-19 å‘¨ï¼‰     â”‚
â”‚   âœ… åŠŸèƒ½å®Œæ•´ï¼ˆè§£å†³ Playwright ç¼ºé™·ï¼‰      â”‚
â”‚   âœ… æ€§èƒ½ä¼˜ç§€ï¼ˆå…³é”®è·¯å¾„ç”¨ CDPï¼‰            â”‚
â”‚   âœ… ç»´æŠ¤ç®€å•ï¼ˆ80% ç®€å•ä»£ç ï¼‰              â”‚
â”‚   âœ… æœªæ¥å¯æ‰©å±•ï¼ˆè·¨æµè§ˆå™¨ã€ç”Ÿæ€ç³»ç»Ÿï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.4 å®æ–½å»ºè®®

```python
ç«‹å³è¡ŒåŠ¨ï¼š
=========
1. âœ… é‡‡ç”¨ Playwright + CDP æ··åˆæ–¹æ¡ˆ
2. âœ… å…ˆç”¨ Playwright æ„å»ºæ ¸å¿ƒï¼ˆ4-6 å‘¨ï¼‰
3. âœ… å†ç”¨ CDP è¡¥å……å…³é”®åŠŸèƒ½ï¼ˆ1-2 å‘¨ï¼‰
4. âœ… æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ1-2 å‘¨ï¼‰

æŠ€æœ¯é€‰å‹ï¼š
=========
- ä¸»æ¡†æ¶ï¼šplaywright-python >= 1.40.0
- CDP åº“ï¼šcdp-use >= 1.4.4 (browser-use ä½¿ç”¨)
- äº‹ä»¶æ€»çº¿ï¼šå¯é€‰ï¼ˆä¸å¼ºåˆ¶ bubusï¼‰

æ¶æ„è®¾è®¡ï¼š
=========
- å°è£… EnhancedPage ç»Ÿä¸€æ¥å£
- 80% ä½¿ç”¨ Playwright API
- 20% ä½¿ç”¨ CDP APIï¼ˆé™å®šåœºæ™¯ï¼‰
- æ¸…æ™°çš„æ–‡æ¡£è¯´æ˜ä½•æ—¶ä½¿ç”¨å“ªç§ API

é¢„æœŸæ”¶ç›Šï¼š
=========
- å¼€å‘æ—¶é—´ï¼š7-10 å‘¨ï¼ˆvs çº¯CDPçš„13-19å‘¨ï¼‰
- ç»´æŠ¤æˆæœ¬ï¼šä¸­ç­‰ï¼ˆvs çº¯CDPçš„æé«˜ï¼‰
- åŠŸèƒ½å®Œæ•´ï¼š100%ï¼ˆvs çº¯Playwrightçš„90%ï¼‰
- æ€§èƒ½ï¼šä¼˜ç§€ï¼ˆå…³é”®è·¯å¾„ç”¨CDPï¼‰
```

---

## 10. å‚è€ƒèµ„æ–™

### 10.1 æ–‡æ¡£

- [Chrome DevTools Protocol](https://chromedevtools.github.io/devtools-protocol/)
- [Playwright å®˜æ–¹æ–‡æ¡£](https://playwright.dev/python/)
- [cdp-use GitHub](https://github.com/cdp-use/cdp-use)
- [Playwright CDP Session](https://playwright.dev/python/docs/api/class-cdpsession)

### 10.2 ç›¸å…³é¡¹ç›®

- [browser-use](https://github.com/browser-use/browser-use) - çº¯ CDP å®ç°
- [Puppeteer](https://pptr.dev/) - Node.js CDP å°è£…
- [Selenium](https://www.selenium.dev/) - WebDriver åè®®

---

**åˆ†æå®Œæˆæ—¥æœŸ**ï¼š2025-12-18  
**åˆ†æå›¢é˜Ÿ**ï¼šAeroTest AI æŠ€æœ¯å›¢é˜Ÿ  
**å†³ç­–å»ºè®®**ï¼šâœ… **é‡‡ç”¨ Playwright + CDP æ··åˆæ–¹æ¡ˆ**

---

**æ–‡æ¡£ç»“æŸ**

