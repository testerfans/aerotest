# AeroTest AI å·¥ç¨‹æ¶æ„è¯´æ˜

## ğŸ“‹ ç›®å½•ç»“æ„

```
aerotest-ai/
â”œâ”€â”€ aerotest/                    # ä¸»ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ cli.py                  # å‘½ä»¤è¡Œå·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ client.py          # AeroTest å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ types.py           # æ ¸å¿ƒæ•°æ®ç±»å‹
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ funnel/            # äº”å±‚æ¼æ–—å¼•æ“
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ engine.py      # æ¼æ–—å¼•æ“æ ¸å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py        # åŸºç±»å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ l1_rule.py     # L1 è§„åˆ™æ§½ä½å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ l2_attribute.py # L2 å±æ€§åŒ¹é…å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ l3_spatial.py   # L3 ç©ºé—´æ¨ç†å±‚ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ l4_reasoning.py # L4 AIæ¨ç†å±‚ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ l5_vision.py    # L5 è§†è§‰è¯†åˆ«å±‚ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ooda/              # OODA å†³ç­–å¾ªç¯ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ observe.py     # è§‚å¯Ÿé˜¶æ®µ
â”‚   â”‚   â”‚   â”œâ”€â”€ orient.py      # å®šå‘é˜¶æ®µ
â”‚   â”‚   â”‚   â”œâ”€â”€ decide.py      # å†³ç­–é˜¶æ®µ
â”‚   â”‚   â”‚   â””â”€â”€ act.py         # è¡ŒåŠ¨é˜¶æ®µ
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ integration/       # browser-use é›†æˆ
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ browser_adapter.py # æµè§ˆå™¨é€‚é…å™¨
â”‚   â”‚       â””â”€â”€ dom_adapter.py     # DOM é€‚é…å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ai/                     # AI æ¨¡å‹é›†æˆ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ qwen.py        # é€šä¹‰åƒé—®å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ prompts/           # Prompt æ¨¡æ¿
â”‚   â”‚       â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ browser/                # æµè§ˆå™¨æ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ cdp/               # CDP åè®®å±‚
â”‚   â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ session/           # ä¼šè¯ç®¡ç†
â”‚   â”‚       â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                     # æ•°æ®åº“å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py            # åŸºç±»
â”‚   â”‚   â”œâ”€â”€ session.py         # ä¼šè¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ test_case.py  # æµ‹è¯•ç”¨ä¾‹æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ test_result.py # æµ‹è¯•ç»“æœæ¨¡å‹
â”‚   â”‚   â””â”€â”€ migrations/        # æ•°æ®åº“è¿ç§»
â”‚   â”‚       â”œâ”€â”€ env.py
â”‚   â”‚       â””â”€â”€ script.py.mako
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                    # API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py            # FastAPI åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ routes/            # è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ health.py      # å¥åº·æ£€æŸ¥
â”‚   â”‚   â”‚   â””â”€â”€ test_cases.py  # æµ‹è¯•ç”¨ä¾‹ç›¸å…³
â”‚   â”‚   â””â”€â”€ schemas/           # API Schema
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ test_case.py   # æµ‹è¯•ç”¨ä¾‹ Schema
â”‚   â”‚
â”‚   â”œâ”€â”€ scheduler/              # ä»»åŠ¡è°ƒåº¦ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·ç±»
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ logger.py          # æ—¥å¿—å·¥å…·
â”‚   â”‚
â”‚   â””â”€â”€ config/                 # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ settings.py        # é…ç½®ç±»
â”‚
â”œâ”€â”€ tests/                      # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py            # Pytest é…ç½®
â”‚   â”œâ”€â”€ unit/                  # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_config.py
â”‚   â”‚   â””â”€â”€ test_funnel.py
â”‚   â”œâ”€â”€ integration/           # é›†æˆæµ‹è¯•
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â””â”€â”€ e2e/                   # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚       â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”‚   â”œâ”€â”€ requirement.md         # éœ€æ±‚æ–‡æ¡£
â”‚   â”œâ”€â”€ AeroTest-æŠ€æœ¯æ¶æ„è®¾è®¡.md
â”‚   â”œâ”€â”€ browser-use-CDPä»£ç å¤ç”¨åˆ†æ.md
â”‚   â””â”€â”€ å·¥ç¨‹æ¶æ„è¯´æ˜.mdï¼ˆæœ¬æ–‡æ¡£ï¼‰
â”‚
â”œâ”€â”€ scripts/                    # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ init_project.py        # é¡¹ç›®åˆå§‹åŒ–
â”‚   â””â”€â”€ generate_migration.sh  # ç”Ÿæˆè¿ç§»è„šæœ¬
â”‚
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ knowledge_base/        # è‡ªæ„ˆçŸ¥è¯†åº“
â”‚   â””â”€â”€ reports/               # æµ‹è¯•æŠ¥å‘Š
â”‚
â”œâ”€â”€ config/                     # é…ç½®æ–‡ä»¶ç›®å½•
â”œâ”€â”€ logs/                       # æ—¥å¿—ç›®å½•
â”œâ”€â”€ browser-use/               # browser-use ä¾èµ–ï¼ˆå·²å…‹éš†ï¼‰
â”‚
â”œâ”€â”€ pyproject.toml             # Poetry é¡¹ç›®é…ç½®
â”œâ”€â”€ alembic.ini                # Alembic é…ç½®
â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                 # Git å¿½ç•¥é…ç½®
â”œâ”€â”€ LICENSE                    # è®¸å¯è¯
â””â”€â”€ README.md                  # é¡¹ç›®è¯´æ˜

```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CLI / API / Web UI             â”‚  åº”ç”¨å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        AeroTestClient (æ ¸å¿ƒå®¢æˆ·ç«¯)       â”‚  å®¢æˆ·ç«¯å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      äº”å±‚æ¼æ–—å¼•æ“ (FunnelEngine)         â”‚  å†³ç­–å±‚
â”‚  L1â†’L2â†’L3â†’L4â†’L5 (å±‚å±‚é€’è¿›)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     browser-use é›†æˆ (é€‚é…å™¨æ¨¡å¼)        â”‚  é›†æˆå±‚
â”‚  BrowserAdapter + DomAdapter            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           CDP åè®®å±‚                    â”‚  åè®®å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      æ•°æ®åº“å±‚ (SQLAlchemy + Alembic)    â”‚  æŒä¹…åŒ–å±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡å—è¯´æ˜

#### 1. Core æ¨¡å—ï¼ˆæ ¸å¿ƒï¼‰

- **client.py**: AeroTest å®¢æˆ·ç«¯ï¼Œæä¾›ç»Ÿä¸€çš„æµ‹è¯•æ‰§è¡Œæ¥å£
- **types.py**: æ ¸å¿ƒæ•°æ®ç±»å‹å®šä¹‰ï¼ˆTestCase, TestResult, TestStep ç­‰ï¼‰
- **funnel/**: äº”å±‚æ¼æ–—å¼•æ“ï¼Œæ ¸å¿ƒå†³ç­–å¼•æ“
- **ooda/**: OODA å†³ç­–å¾ªç¯å®ç°
- **integration/**: browser-use é›†æˆé€‚é…å™¨

#### 2. AI æ¨¡å—

- **models/qwen.py**: é€šä¹‰åƒé—®æ¨¡å‹å®¢æˆ·ç«¯
- **prompts/**: Prompt æ¨¡æ¿åº“ï¼ˆå¾…å®ç°ï¼‰

#### 3. Browser æ¨¡å—

- **cdp/**: CDP åè®®å°è£…ï¼ˆå¾…å®ç°ï¼‰
- **session/**: æµè§ˆå™¨ä¼šè¯ç®¡ç†ï¼ˆå¾…å®ç°ï¼‰

#### 4. DB æ¨¡å—

- **models/**: SQLAlchemy æ•°æ®æ¨¡å‹
- **migrations/**: Alembic æ•°æ®åº“è¿ç§»
- **session.py**: å¼‚æ­¥æ•°æ®åº“ä¼šè¯ç®¡ç†

#### 5. API æ¨¡å—

- **main.py**: FastAPI åº”ç”¨å…¥å£
- **routes/**: API è·¯ç”±å®šä¹‰
- **schemas/**: Pydantic Schema å®šä¹‰

## ğŸ”§ æŠ€æœ¯æ ˆ

| å±‚æ¬¡ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|-----|---------|------|
| **é©±åŠ¨å±‚** | CDP (Chrome DevTools Protocol) | åº•å±‚æµè§ˆå™¨æ§åˆ¶ |
| **é›†æˆå±‚** | browser-use (Python) | å¤ç”¨ DOM å¤„ç†å’Œä¼šè¯ç®¡ç† |
| **NLP** | jieba + rapidfuzz | ä¸­æ–‡åˆ†è¯ + æ¨¡ç³ŠåŒ¹é… |
| **AI æ¨ç†** | é€šä¹‰åƒé—® (Qwen-Max/Plus) | L4 å±‚æ™ºèƒ½æ¨ç† |
| **è§†è§‰è¯†åˆ«** | é€šä¹‰åƒé—® VL (Qwen2-VL) | L5 å±‚è§†è§‰å®šä½ |
| **åç«¯æ¡†æ¶** | FastAPI + Uvicorn | å¼‚æ­¥ Web æ¡†æ¶ |
| **æ•°æ®åº“** | PostgreSQL + SQLAlchemy | å…³ç³»å‹æ•°æ®åº“ |
| **ç¼“å­˜** | Redis | ç¼“å­˜å’Œä¼šè¯å­˜å‚¨ |
| **æ—¥å¿—** | Loguru | ç»“æ„åŒ–æ—¥å¿— |
| **é…ç½®** | Pydantic Settings | ç±»å‹å®‰å…¨çš„é…ç½®ç®¡ç† |
| **æµ‹è¯•** | Pytest + pytest-asyncio | æµ‹è¯•æ¡†æ¶ |

## ğŸ“¦ ä¾èµ–ç®¡ç†

ä½¿ç”¨ **Poetry** è¿›è¡Œä¾èµ–ç®¡ç†ï¼š

- **æ ¸å¿ƒä¾èµ–**: è§ `pyproject.toml` çš„ `[tool.poetry.dependencies]`
- **å¼€å‘ä¾èµ–**: è§ `[tool.poetry.group.dev.dependencies]`

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–é¡¹ç›®

```bash
# å®‰è£…ä¾èµ–
poetry install

# åˆå§‹åŒ–é…ç½®
poetry run python scripts/init_project.py

# ç¼–è¾‘ .env æ–‡ä»¶
cp .env.example .env
# ä¿®æ”¹ .env ä¸­çš„é…ç½®é¡¹
```

### 2. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆ›å»ºæ•°æ®åº“è¡¨
poetry run alembic upgrade head
```

### 3. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
poetry run pytest

# è¿è¡Œå•å…ƒæµ‹è¯•
poetry run pytest tests/unit/

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
poetry run pytest --cov=aerotest --cov-report=html
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼
poetry run aerotest serve

# æˆ–ç›´æ¥ä½¿ç”¨ uvicorn
poetry run uvicorn aerotest.api.main:app --reload
```

### 5. API æ–‡æ¡£

å¯åŠ¨æœåŠ¡åè®¿é—®ï¼š

- Swagger UI: http://localhost:8000/api/docs
- ReDoc: http://localhost:8000/api/redoc

## ğŸ“ å¼€å‘æµç¨‹

### ä»£ç é£æ ¼

ä½¿ç”¨ Black + Ruff è¿›è¡Œä»£ç æ ¼å¼åŒ–å’Œ Lint æ£€æŸ¥ï¼š

```bash
# æ ¼å¼åŒ–ä»£ç 
poetry run black aerotest/

# Lint æ£€æŸ¥
poetry run ruff check aerotest/

# ç±»å‹æ£€æŸ¥
poetry run mypy aerotest/
```

### æ•°æ®åº“è¿ç§»

```bash
# ç”Ÿæˆè¿ç§»è„šæœ¬
poetry run alembic revision --autogenerate -m "æè¿°"

# æ‰§è¡Œè¿ç§»
poetry run alembic upgrade head

# å›æ»šè¿ç§»
poetry run alembic downgrade -1
```

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨å¯¹åº”æ¨¡å—ä¸‹åˆ›å»ºæ–°æ–‡ä»¶
2. ç¼–å†™ä¸šåŠ¡é€»è¾‘
3. æ·»åŠ å•å…ƒæµ‹è¯•
4. æ›´æ–°æ–‡æ¡£

## ğŸ” ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

### Phase 1: browser-use é›†æˆï¼ˆå½“å‰ï¼‰

- [ ] å®Œå–„ BrowserAdapter
- [ ] å®Œå–„ DomAdapter
- [ ] é›†æˆ browser-use çš„ DomService
- [ ] é›†æˆ browser-use çš„ Session Manager

### Phase 2: L1-L2 å±‚å®ç°

- [ ] å®Œå–„ L1 è§„åˆ™æ§½ä½å±‚
- [ ] å®Œå–„ L2 å±æ€§åŒ¹é…å±‚
- [ ] æ·»åŠ å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹

### Phase 3: L3-L5 å±‚å®ç°

- [ ] å®ç° L3 ç©ºé—´æ¨ç†å±‚
- [ ] å®ç° L4 AI æ¨ç†å±‚
- [ ] å®ç° L5 è§†è§‰è¯†åˆ«å±‚

### Phase 4: å¹³å°åŒ–åŠŸèƒ½

- [ ] å®Œå–„ API æ¥å£
- [ ] å®ç°ä»»åŠ¡è°ƒåº¦å™¨
- [ ] å®ç°æŠ¥å‘Šç³»ç»Ÿ
- [ ] å¼€å‘ Web UI

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [éœ€æ±‚æ–‡æ¡£](requirement.md)
- [æŠ€æœ¯æ¶æ„è®¾è®¡](AeroTest-æŠ€æœ¯æ¶æ„è®¾è®¡.md)
- [browser-use ä»£ç å¤ç”¨åˆ†æ](browser-use-CDPä»£ç å¤ç”¨åˆ†æ.md)

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](../LICENSE) æ–‡ä»¶

