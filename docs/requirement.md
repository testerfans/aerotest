# AeroTest AI 2.0 平台需求规格说明书

## 文档信息
- **版本**：v2.0
- **最后更新**：2025-12-18
- **状态**：需求评审中

---

## 目录
1. [平台定位](#1-平台定位)
2. [核心系统：五层漏斗过滤机制](#2-核心系统五层漏斗过滤机制)
3. [功能模块](#3-功能模块)
4. [技术架构](#4-技术架构)
5. [非功能需求](#5-非功能需求)
6. [实施路线图](#6-实施路线图)
7. [风险与应对](#7-风险与应对)

---

## 1. 平台定位

### 1.1 产品概述
AeroTest AI 是一个基于 **OODA (观察-调整-决定-执行)** 环架构的下一代 AI 自动化测试平台。它通过自研的"五层漏斗"技术，将自然语言意图转化为精准的浏览器操作。

### 1.2 核心价值
- ✅ **解决非标控件识别难**：通过空间布局推理 + AI视觉识别
- ✅ **降低脚本维护成本**：自愈知识库 + 自然语言用例
- ✅ **控制 AI 消耗成本**：L1-L3 零Token消耗处理80%场景

### 1.3 目标用户
- 测试工程师：快速编写和维护自动化用例
- 测试开发：平台化管理和深度定制
- 项目经理：通过率趋势和执行报告

---

## 2. 核心系统：五层漏斗过滤机制

这是引擎的决策核心，每一步操作都会经过这五层过滤，**置信度达标即执行，不达标则下沉**。

### L1：语义槽规则层 (Rule-based Slotting)

**目标**：极速处理标准指令（< 50ms）

**逻辑**：
- **动作提取**：利用 NLP 正则提取指令中的 Action（点击、输入、选择、滚动、验证）
- **变量注入**：自动将 `${phone}` 等占位符替换为测试变量池中的真实数据
- **同义词映射**：将"点一下"、"按下"、"确定"等统一映射为标准 Click 动作

**支持的动作类型**：
```yaml
- Click: 点击、点、按、按下、选择
- Input: 输入、填写、键入
- Select: 选择、下拉选择
- Scroll: 滚动、向下滑动
- Assert: 验证、断言、检查
- Wait: 等待、暂停
```

**输出**：
- 成功：`{action: "Click", target: "提交按钮", confidence: 1.0}`
- 失败：下沉到 L2

---

### L2：结构化属性硬匹配 (Heuristic Attribute Match)

**目标**：0 Token 消耗解决 80% 的标准 Web 控件（< 200ms）

**逻辑**：
- 在 DOM 中直接检索 `placeholder`、`aria-label`、`id`、`name`、`innerText`、`title`、`alt` 等关键属性
- 使用模糊字符串匹配 (Fuzzy Match)，对候选元素进行置信度打分
- **命中分支**：若得分 > 0.95 且唯一，直接返回 Selector

**属性优先级**：
1. `id` / `data-testid` (权重: 1.0)
2. `aria-label` / `placeholder` (权重: 0.9)
3. `name` / `title` (权重: 0.8)
4. `innerText` 精确匹配 (权重: 0.85)
5. `innerText` 模糊匹配 (权重: 0.7)

**增强功能**：
- **iframe 自动探测**：先在主 frame 查找，未找到则遍历所有 iframe（最多3层）
- **Shadow DOM 穿透**：支持 `>>>` 组合选择器
- **动态等待**：若未找到元素，等待 500ms 后重试 1 次

**输出**：
- 成功：`{selector: "input[placeholder='请输入手机号']", confidence: 0.96}`
- 失败：下沉到 L3

---

### L3：空间布局锚点层 (Spatial Layout Reasoning)

**目标**：解决非标控件（如 label 与 input 分离，且无关联属性）（< 500ms）

**逻辑**：
- **锚点定位**：先找到包含目标文本（如"手机号"）的非交互元素（`<label>`, `<span>`, `<div>`）
- **邻近探测**：扫描锚点元素的相对位置关系：
  - 右侧 50 像素范围内的第一个可交互元素
  - 下方 50 像素范围内的第一个可交互元素
  - 同一行内的下一个兄弟节点
- **层级穿透**：自动探测该区域内绑定了 `Click` 或 `Input` 事件监听器的非标准标签

**相对位置算法**：
```python
# 判断元素是否在同一行/列
def is_aligned(anchor_rect, target_rect):
    horizontal_aligned = abs(anchor_rect.top - target_rect.top) < 10  # 同一行
    vertical_aligned = abs(anchor_rect.left - target_rect.left) < 10  # 同一列
    return horizontal_aligned or vertical_aligned
```

**可配置参数**：
- `proximity_threshold`: 邻近阈值（默认 50px，支持百分比）
- `max_scan_depth`: 最大扫描层级（默认 3）
- `event_listener_types`: 监听器类型（`['click', 'input', 'change']`）

**输出**：
- 成功：`{selector: "div.custom-input-wrapper > div:first-child", confidence: 0.88, method: "spatial"}`
- 失败：下沉到 L4

---

### L4：意图推理层 (Qwen-Max/Plus Reasoning)

**目标**：解决歧义或复杂逻辑（如：页面有三个"删除"按钮，需要结合上下文）（< 3s）

**逻辑**：
- **精简上下文**：提取当前操作目标周围的 DOM 片段（剔除无用样式、脚本）
  - 父级 3 层 + 兄弟节点 2 个 + 子级 1 层
  - 只保留关键属性：`class`, `id`, `text`, `role`, `aria-*`
- **Prompt 策略**：
  ```
  用户想执行：'删除第二条订单'
  当前页面有以下候选元素：
  [1] <button class="delete-btn">删除</button> (父级: order-item-1)
  [2] <button class="delete-btn">删除</button> (父级: order-item-2)
  [3] <button class="delete-btn">删除</button> (父级: order-item-3)
  
  请返回最匹配的元素序号，仅返回数字。
  ```
- **反馈修正**：AI 若反馈页面出现了阻挡（如弹窗），则临时中断当前漏斗，启动"阻挡清除"子流程

**成本控制**：
- **缓存机制**：相似 DOM 结构（结构哈希相同）复用推理结果，有效期 10 分钟
- **Token 预算**：单次调用最大 2000 tokens，超过则降级到截图模式
- **降级策略**：若 AI 返回"无法判断"，自动跳转到 L5

**输出**：
- 成功：`{selector: ".order-item-2 .delete-btn", confidence: 0.92, tokens_used: 456}`
- 失败：下沉到 L5

---

### L5：多模态视觉感知层 (Qwen2-VL Vision)

**目标**：终极兜底，解决 Canvas 渲染、复杂图标、或 DOM 无法识别的极端非标 UI（< 5s）

**逻辑**：
- **截图标识**：截取当前屏幕，利用 OmniParser 标识出所有可点击热区
- **视觉指令**：将带编号的截图发给 Qwen2-VL：
  ```
  请在图中找到"手机端预览"的关闭图标（通常是×或close），
  返回其中心坐标 (x, y)，格式：{"x": 120, "y": 340}
  ```
- **强制执行**：CDP 绕过 DOM 定位，直接进行坐标级点击（Input.dispatchMouseEvent）

**稳定性增强**：
- **渲染等待**：截图前等待 `networkidle` 状态，确保内容完整
- **坐标验证**：点击前模拟 `hover` 事件，验证目标位置是否可点击
- **分辨率自适应**：记录截图时的 viewport 尺寸，执行时自动缩放坐标
- **Canvas 优先处理**：若元素为 Canvas，先尝试通过 Canvas API 获取点击区域

**重试机制**：
- 若视觉识别也失败，记录当前步骤为 **"待人工确认"**
- 根据配置决定是否继续执行后续步骤（`continue_on_failure: true/false`）

**输出**：
- 成功：`{coordinates: {x: 845, y: 120}, confidence: 0.85, method: "vision"}`
- 失败：标记为"需人工介入"，生成详细失败报告

---

## 3. 功能模块

### 3.1 全链路诊断与观测模块 (Observability)

#### 3.1.1 智能报告
- **多格式支持**：HTML、Allure、JSON
- **关联视图**：步骤 - 截图 - 网络日志 - 控制台日志四维绑定
- **漏斗层级标识**：每个步骤显示命中的层级（L1-L5）和耗时

#### 3.1.2 网络分析
- **实时监听**：`Network.request` / `Network.response`
- **异常捕获**：接口 500、超时、CORS 错误
- **智能标注**：在报告中标记"此步骤失败疑为后端接口 `/api/order` 返回 500"

#### 3.1.3 CDP Trace 录制
- **自动录制**：CDP Performance Timeline 全程录制
- **失败回溯**：用户可查看每个步骤的完整 CDP 事件和 DOM 状态
- **网络瀑布图**：基于 CDP Network 事件生成详细的网络分析

#### 3.1.4 控制台追踪
- **日志对齐**：自动将浏览器 Console 的 Error 日志与执行步骤对齐
- **JS 错误定位**：精准定位 JS 注入或前端逻辑错误

#### 3.1.5 深度分析（新增）
- **失败分类统计**：
  - 元素定位失败（占比 X%）
  - 接口异常（占比 Y%）
  - 断言失败（占比 Z%）
- **趋势分析**：
  - 用例通过率趋势图（最近 30 次执行）
  - 平均执行时长变化
  - AI 层调用频率统计（成本分析）
- **智能诊断**：
  - 相同失败步骤聚合："最近 5 次执行都在'登录'步骤失败"
  - 推荐修复："该元素 Selector 在 L2 层失败 3 次，建议添加到自愈知识库"

---

### 3.2 平台化管理模块 (Management)

#### 3.2.1 用例中心
- **用例导入**：支持自然语言用例上传（CSV/Excel/JSON）
- **版本管理**：Git-like 版本控制，支持回滚和对比
- **用例分组**：按模块、优先级、标签分类
- **依赖管理**：配置用例间依赖关系（用例 A 失败则跳过用例 B）

**用例格式示例**：
```yaml
# 自然语言用例
- name: "用户登录流程"
  steps:
    - "打开页面 ${baseURL}/login"
    - "输入手机号 ${phone}"
    - "输入密码 ${password}"
    - "点击登录按钮"
    - "验证页面显示'欢迎回来'"
```

#### 3.2.2 配置中心
- **环境管理**：
  - 灵活切换 BaseURL、多套测试账号
  - 支持 Dev / Test / Staging / Production 环境
- **AI 策略配置**：
  - Token 预算设置（单用例最大消耗）
  - 超过预算自动回滚到 L2/L3 层或报警
  - 模型选择：Qwen-Max（精度优先） / Qwen-Plus（速度优先）
- **浏览器配置**：
  - 浏览器类型：Chrome / Chromium
  - 无头模式 / 有头模式
  - Viewport 尺寸、User-Agent
  - Chrome 启动参数（自定义 flags）

#### 3.2.3 变量与 Mock 中心
- **动态变量生成**：
  - 随机手机号：`${randomPhone}`
  - 随机姓名：`${randomName}`
  - 时间戳：`${timestamp}`
  - UUID：`${uuid}`
- **API Mock**：
  - CDP Fetch Domain 拦截 API，返回 Mock 数据
  - 对接第三方 Mock 平台（YApi、Apifox）
  - 支持场景化 Mock（成功场景 / 失败场景）

#### 3.2.4 自愈知识库
- **Selector 学习**：
  - 记录 L4/L5 成功修复的路径，持久化为规则
  - 下次运行相同用例时，L2 层会自动生效，实现 **越跑越快**
- **知识库管理**：
  - 版本控制：记录知识点的创建时间、成功率、最后使用时间
  - 冲突处理：同一指令在不同页面可能有不同 selector，通过 URL 模式匹配区分
  - 手动审核：支持人工审核自动学习的规则
- **相似度判断**：
  - URL 完全匹配（精确模式）
  - URL 正则匹配（模糊模式，如 `/product/\d+`）
  - 页面结构哈希匹配（DOM 树指纹）

#### 3.2.5 调度与执行中心（新增）
- **执行模式**：
  - 立即执行：单个用例 / 批量用例
  - 定时任务：Cron 表达式配置（如：每天 2:00 执行回归）
  - 触发执行：Git Push 后自动触发（CI/CD 集成）
- **并发策略**：
  - 按模块分组，组内串行，组间并行
  - 最大并发数配置（默认 10）
- **失败重跑**：
  - 失败用例自动重跑 N 次（可配置，默认 1 次）
  - 记录重跑历史，标记"首次失败，重跑成功"

#### 3.2.6 权限与协作（新增）
- **角色权限**：
  - 管理员：配置环境、管理用户、删除数据
  - 测试人员：编辑用例、执行测试、查看报告
  - 开发人员：仅查看报告（只读）
- **用例协作**：
  - 用例锁定机制：编辑时锁定，防止冲突
  - 变更历史：记录"谁在何时修改了什么"
  - 评论功能：在失败步骤添加备注

---

### 3.3 异常处理与恢复机制

#### 3.3.1 动态元素等待（新增）
- **智能等待机制**：
  - L1-L3 层失败后，不直接下沉，先等待 500ms 重试 1 次
  - 监听 DOM `MutationObserver`，检测到变化后重新执行漏斗
  - 最大等待时间可配置（默认 10s）
- **特殊场景处理**：
  - 懒加载列表：滚动触发加载时，自动等待接口返回
  - 骨架屏/Loading：识别 loading 状态，等待其消失
  - SPA 路由跳转：监听 URL 变化和 `document.readyState`

#### 3.3.2 页面异常自动恢复（新增）
- **常见阻挡物检测与自动清除**：
  - Modal 弹窗：识别 mask 层，点击关闭按钮或按 ESC 键
  - Cookie 同意：识别"同意"、"Accept"等常见文案
  - 广告弹窗：识别 close 图标（×）并点击
  - 新手引导：识别"跳过"、"知道了"
- **页面崩溃恢复**：
  - 检测到白屏 / Network Error，自动刷新页面
  - 最多重试 3 次，失败则标记用例为"环境异常"

#### 3.3.3 数据隔离与清理（新增）
- **用例钩子**：
  - `setUp`: 创建测试数据、登录、设置 Cookie
  - `tearDown`: 删除测试数据、清理缓存
- **浏览器状态管理**：
  - 每个用例独立 Context（隔离 Cookie / LocalStorage）
  - 支持持久化 Context（需要保留登录态的场景）

#### 3.3.4 自动滚动
- **滚动策略**：执行层发现元素不可见时，自动尝试 `scrollIntoView`
- **智能滚动**：若元素在 sticky header 下方，额外向下滚动 100px

#### 3.3.5 降级策略
- 如果 Qwen2-VL 定位也失败，则记录当前步骤为 **"待人工确认"**
- 根据配置决定是否继续执行用例（`continue_on_failure` 开关）

#### 3.3.6 回执闭环
- 每次动作执行后，立即检查 DOM 是否发生预期变化
- 若无变化则判定为"无效操作"，重新触发 OODA 环
- 最多重试 2 次，失败则报错

---

### 3.4 验证与断言能力（新增）

#### 3.4.1 内置断言类型
- **元素存在性**：
  ```yaml
  - "验证提交按钮存在"
  - "验证页面不存在错误提示"
  ```
- **文本验证**：
  ```yaml
  - "验证订单状态包含'已完成'"
  - "验证页面标题等于'订单详情'"
  ```
- **接口断言**：
  ```yaml
  - "验证接口 /api/order 返回状态码 200"
  - "验证接口响应包含字段 'order_id'"
  ```
- **截图对比**：
  ```yaml
  - "验证页面截图与基准图相似度 > 95%"
  ```

#### 3.4.2 AI 辅助断言
- **语义理解**：
  - "验证页面是否显示成功提示" → L4 层理解语义并生成断言
- **自动识别临时提示**：
  - 自动捕获 toast、notification 等临时提示（5s 内消失）
  - 记录到报告中

---

## 4. 技术架构

### 4.1 技术栈选型

#### 4.1.1 核心组件
- **驱动层**：CDP (Chrome DevTools Protocol)
  - 基于 browser-use 框架（复用成熟能力）
  - cdp-use：底层 CDP 客户端
  - 支持 Chrome/Chromium 浏览器
  - 完善的 DOM 提取和元素交互能力
  - 高性能事件监听和网络拦截
- **AI 层**：阿里百炼平台 API
  - Qwen-Max：意图推理（L4）
  - Qwen-Plus：轻量推理（成本优化）
  - Qwen2-VL：视觉识别（L5）
  - OmniParser：热区标识
- **后端**：FastAPI + PostgreSQL
  - FastAPI：高性能异步框架
  - PostgreSQL：用例、配置、知识库持久化
  - Redis：缓存、队列、分布式锁
- **前端**：React + Ant Design
  - 用例管理界面
  - 报告查看器
  - 配置中心
- **报告**：自定义 HTML + CDP Trace
  - 自定义 HTML：深度分析报告
  - CDP Trace：完整的浏览器操作回放

#### 4.1.2 架构图
```
┌─────────────────────────────────────────────────────────────┐
│                        前端 (React)                          │
│  用例编辑器 | 执行控制台 | 报告查看器 | 配置中心 | 知识库管理│
└────────────────────────┬────────────────────────────────────┘
                         │ HTTP/WebSocket
┌────────────────────────▼────────────────────────────────────┐
│                   后端 (FastAPI)                             │
│  API Gateway | 用例服务 | 执行调度 | 报告服务 | 知识库服务  │
└────────────┬───────────────────────────┬────────────────────┘
             │                           │
     ┌───────▼────────┐         ┌────────▼────────┐
     │  PostgreSQL    │         │     Redis       │
     │ (用例/配置/报告)│         │ (缓存/队列/锁)  │
     └────────────────┘         └─────────────────┘
             │
┌────────────▼────────────────────────────────────────────────┐
│           执行引擎 (browser-use + OODA + 五层漏斗)           │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  browser-use 核心层 (复用)                            │  │
│  │  - BrowserSession (会话管理)                         │  │
│  │  - DomService (DOM 提取)                             │  │
│  │  - DOM Serializer (元素序列化)                       │  │
│  │  - Actor Layer (元素交互)                            │  │
│  └──────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  AeroTest 扩展层 (自研)                              │  │
│  │  - 五层漏斗引擎 (L1-L5)                              │  │
│  │  - OODA 执行循环                                     │  │
│  │  - 自愈知识库                                        │  │
│  │  - 阻挡物自动清除                                    │  │
│  └──────────────────────────────────────────────────────┘  │
└────────────┬───────────────────────────┬────────────────────┘
             │                           │
     ┌───────▼────────┐         ┌────────▼────────┐
     │ Chrome Browser │         │  阿里百炼 API   │
     │  (CDP 连接)    │         │ (Qwen系列模型)  │
     │ ┌────────────┐ │         └─────────────────┘
     │ │ cdp-use    │ │
     │ │ (WebSocket)│ │
     │ └────────────┘ │
     └────────────────┘
```

### 4.2 核心流程

#### 4.2.1 用例执行流程（OODA 环）
```
1. Observe (观察)
   ├─ 解析用例步骤 (L1)
   ├─ 获取当前页面 DOM 快照
   ├─ 检测页面状态 (loading/ready)
   └─ 识别阻挡物 (弹窗/遮罩)

2. Orient (调整)
   ├─ 通过五层漏斗定位元素
   ├─ 评估置信度
   └─ 决定执行策略

3. Decide (决定)
   ├─ 生成执行指令 (Selector/Coordinates)
   ├─ 检查元素可见性/可交互性
   └─ 准备回执验证逻辑

4. Act (执行)
   ├─ 执行浏览器操作
   ├─ 截图 + 录制 Trace
   ├─ 验证回执 (DOM 变化)
   └─ 记录日志 (步骤/耗时/Token)

5. 循环
   └─ 若失败，重新进入 OODA 环（最多 2 次）
```

#### 4.2.2 自愈知识库更新流程
```
1. L4/L5 成功定位元素
   └─ 记录：{url_pattern, instruction, selector, confidence}

2. 计算页面指纹
   └─ DOM 树结构哈希 + URL 特征

3. 持久化到知识库
   └─ 标记状态：待审核 / 已生效

4. 下次执行相同指令
   └─ L2 层优先查询知识库，命中则直接返回 Selector
```

---

## 5. 非功能需求

### 5.1 性能指标

#### 5.1.1 响应时间
- **L1 层**：< 50ms
- **L2 层**：< 200ms
- **L3 层**：< 500ms
- **L4 层**：< 3s（含 AI 调用）
- **L5 层**：< 5s（含截图 + 视觉识别）

#### 5.1.2 并发能力
- **单机**：支持 10 个 Browser 实例并发
- **AI API**：调用池 20 QPS
- **执行队列**：最多堆积 100 个任务

#### 5.1.3 资源消耗
- **内存**：单 Browser 实例 < 500MB
- **CPU**：峰值 < 80%
- **磁盘**：Trace 文件自动清理（保留最近 7 天）

---

### 5.2 可用性

#### 5.2.1 容错能力
- **用例失败率 < 5%**（环境稳定前提下）
- **单步骤重试 2 次**
- **失败自动重跑 1 次**

#### 5.2.2 可维护性
- **日志体系**：
  - 应用日志：平台自身运行日志（级别：INFO/WARN/ERROR）
  - 用例日志：每个步骤的执行详情（漏斗层级/耗时/Selector）
  - AI 日志：Prompt / Response / Token 消耗
- **监控告警**：
  - 用例失败率 > 30% 发送告警
  - AI Token 消耗超预算告警
  - 执行队列堆积 > 50 告警

---

### 5.3 安全性

#### 5.3.1 数据安全
- **敏感数据加密**：
  - 测试账号密码使用 AES-256 加密存储
  - API Token 不落盘，从环境变量读取
- **访问控制**：
  - IP 白名单（仅内网访问）
  - 操作审计日志（谁执行了删除/修改操作）

#### 5.3.2 接口安全
- **认证**：JWT Token + RefreshToken
- **授权**：基于角色的访问控制（RBAC）
- **限流**：单用户 QPS 限制（10 req/s）

---

### 5.4 可扩展性

#### 5.4.1 水平扩展
- **执行节点**：支持多机分布式执行
- **数据库**：支持读写分离、主从复制

#### 5.4.2 插件化
- **自定义动作**：支持注册自定义动作类型（如：拖拽、长按）
- **自定义断言**：支持注册自定义断言逻辑
- **Hook 机制**：支持用例前置/后置钩子

---

## 6. 实施路线图

### 6.1 阶段一：MVP 核心引擎（1-2 个月）
**目标**：验证五层漏斗技术可行性

**交付物**：
- ✅ L1-L3 漏斗层实现
- ✅ Playwright 基础封装
- ✅ 简单的 HTML 报告
- ✅ 本地单机运行
- ✅ 命令行工具（CLI）

**验收标准**：
- 80% 常规场景通过 L1-L2 层定位
- 非标控件通过 L3 层定位成功率 > 60%
- 单用例执行时间 < 30s

---

### 6.2 阶段二：AI 增强（1 个月）
**目标**：引入 AI 能力，覆盖复杂场景

**交付物**：
- ✅ L4 意图推理层（Qwen-Max）
- ✅ Token 成本控制（预算 + 缓存）
- ✅ 自愈知识库本地版（SQLite）

**验收标准**：
- 复杂场景（歧义按钮）定位成功率 > 85%
- 单用例 Token 消耗 < 5000（控制成本）
- 知识库学习后，相同场景 L2 层命中率提升 30%

---

### 6.3 阶段三：视觉与平台化（1-2 个月）
**目标**：完整平台能力，支持团队协作

**交付物**：
- ✅ L5 视觉识别（Qwen2-VL）
- ✅ Web 管理界面（React）
- ✅ 用例中心、配置中心
- ✅ Allure 报告集成

**验收标准**：
- 极端非标场景（Canvas）定位成功率 > 70%
- 支持多用户并发编辑用例
- 报告生成时间 < 10s

---

### 6.4 阶段四：企业级特性（持续迭代）
**目标**：满足企业级应用需求

**交付物**：
- ✅ 调度中心（定时任务、CI/CD 集成）
- ✅ 权限管理（RBAC）
- ✅ 深度报告分析（趋势、诊断）
- ✅ 分布式执行（多节点）

**验收标准**：
- 支持 100+ 并发用例执行
- 报告分析提供智能诊断建议
- CI/CD 集成无缝（GitLab/Jenkins）

---

## 7. 风险与应对

### 7.1 技术风险

| 风险项 | 影响等级 | 概率 | 应对措施 |
|--------|---------|------|----------|
| AI 成本失控 | 高 | 中 | 1. 严格 Token 预算限制<br>2. L1-L3 优化覆盖率<br>3. 缓存机制<br>4. 成本监控告警 |
| 非标控件覆盖率不足 | 中 | 中 | 1. 建立"困难样本库"<br>2. 针对性优化 L3 算法<br>3. L5 视觉兜底<br>4. 持续收集真实场景 |
| 自愈知识库冲突 | 中 | 低 | 1. 增加版本管理<br>2. 支持手动审核<br>3. URL 模式精确匹配<br>4. 冲突检测与提示 |
| Playwright 兼容性 | 低 | 低 | 1. 多浏览器测试<br>2. 定期更新版本<br>3. 异常降级策略 |
| 视觉识别稳定性 | 中 | 中 | 1. 渲染等待机制<br>2. 坐标验证<br>3. 重试策略<br>4. 人工介入备案 |

---

### 7.2 业务风险

| 风险项 | 影响等级 | 概率 | 应对措施 |
|--------|---------|------|----------|
| 用户学习成本高 | 低 | 中 | 1. 交互式教程<br>2. 典型场景模板库<br>3. 视频教学<br>4. 在线文档 |
| 竞品压力 | 中 | 高 | 1. 强化差异化优势（五层漏斗）<br>2. 开源社区建设<br>3. 快速迭代<br>4. 用户反馈闭环 |
| 依赖第三方 API | 中 | 低 | 1. 支持多 AI 供应商（OpenAI、Azure）<br>2. 本地模型备选方案<br>3. 降级策略 |

---

### 7.3 项目风险

| 风险项 | 影响等级 | 概率 | 应对措施 |
|--------|---------|------|----------|
| 开发资源不足 | 高 | 中 | 1. 分阶段交付（MVP 优先）<br>2. 关键模块外包<br>3. 开源社区贡献 |
| 需求变更频繁 | 中 | 高 | 1. 敏捷开发<br>2. 版本管理<br>3. 需求优先级排序 |
| 测试覆盖不足 | 中 | 中 | 1. 单元测试覆盖率 > 80%<br>2. 集成测试自动化<br>3. 真实场景回归测试 |

---

## 8. 附录

### 8.1 术语表

| 术语 | 说明 |
|------|------|
| OODA | Observe-Orient-Decide-Act，观察-调整-决定-执行循环 |
| 五层漏斗 | L1-L5 逐层过滤的元素定位机制 |
| 置信度 | 元素定位的可信程度（0-1） |
| 自愈知识库 | 记录成功定位路径，实现自动修复 |
| Selector | CSS/XPath 选择器 |
| Token | AI 模型的计费单位 |
| Trace | Playwright 录制的执行回放文件 |

### 8.2 参考资料

- [Playwright 官方文档](https://playwright.dev/)
- [阿里百炼平台](https://www.aliyun.com/product/bailian)
- [Qwen2-VL 论文](https://arxiv.org/abs/2409.12191)
- [OmniParser GitHub](https://github.com/microsoft/OmniParser)

---

**文档结束**
